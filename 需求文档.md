# 🌟 诗韵星 (Rhyme Star) AI驱动诗词解析平台 - MVP版本项目设计文档

## 📋 文档信息

- **文档版本**: v1.0 MVP
- **创建日期**: 2025-10-14
- **文档类型**: 项目设计文档 (MVP版)
- **编写视角**: 项目技术负责人/产品经理视角
- **目标读者**: 项目团队、技术负责人、AI专家、文学教育从业者

## 🎯 项目概述

### 项目愿景

构建一个以用户为中心、AI赋能的诗词解析与欣赏生态系统MVP，通过整合用户级AI智能体，为古典诗词爱好者、学生和教师提供个性化解析支持、互动学习体验。本MVP聚焦核心用户解析助手，与现有文学教育资源平台（如古诗文网）初步融合，实现诗词文化传承的初步智能化。

### 核心价值主张 (MVP聚焦)

1. **个性化解析赋能**: AI为用户定制基本解析路径，提供即时解释。
2. **教学互动增效**: 教师查看用户学情，减少重复解析工作。
3. **知识积累**: 沉淀诗词资源，构建基础知识库。
4. **无缝集成外部资源**: 初步统一诗词学习与文化实践数据。

## 🏗️ 系统架构设计 - 基于“灯塔” (L.I.G.H.T.) 架构模式 v3.0 (MVP简化)

本MVP严格遵循L.I.G.H.T.架构核心哲学：最少后端、最强前端智能、Git驱动协作、可伸缩数据层与模板化AI智能体，交付安全、可观测的系统。

**核心哲学**：聚焦用户AI导师，简化到核心组件。

### 整体架构图 (MVP版)

```
┌─────────────────────────────────────────────────────────────┐
│                    前端应用层 (Intelligent Frontend - I)        │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ 用户解析UI │  │ 教师互动UI │                               │
│ └──────────┘  └──────────┘                                   │
│       (Next.js, Vercel AI SDK)                               │
├─────────────────────────────────────────────────────────────┤
│                    API接口层 (Lean Backend - L)                 │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │  统一鉴权  │  │ 敏感数据  │                                 │
│ └──────────┘  └──────────┘                                   │
│        (FastAPI, Vercel Functions)                           │
├─────────────────────────────────────────────────────────────┤
│                  AI编排与业务流程 (Templated AI Agents - T)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐                                                 │
│ │ 用户级AI  │                                                │
│ └──────────┘                                                 │
│       (n8n, LangGraph, Belief DSL (YAML))                     │
├─────────────────────────────────────────────────────────────┤
│                    超大规模数据层 (Hyper-scalable Data - H)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ Supabase  │  │ pgvector  │                                  │
│ │ (PostgreSQL)│  │ (RAG KB)  │                               │
│ └──────────┘  └──────────┘                                   │
├─────────────────────────────────────────────────────────────┤
│                    Git驱动工作流 (Git-driven Workflow - G)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ Monorepo  │  │ CI/CD     │                                  │
│ └──────────┘  └──────────┘                                   │
│       (GitHub, Vercel, Turborepo)                            │
└─────────────────────────────────────────────────────────────┘
```

### 技术架构特点 (MVP)

- **Monorepo 统一管理**: 与现有文学资源代码共享，简化协作。
- **Serverless优先**: Vercel Functions按需伸缩。
- **AI编排核心**: n8n连接用户AI与数据源。
- **Supabase 中心**: PostgreSQL + pgvector构建基础RAG知识库，Realtime实时同步。
- **智能化前端**: Next.js + Vercel AI SDK，提供聊天式体验。

## 🧠 AI智能体架构 (T: Templated AI Agents, MVP聚焦用户级)

MVP仅实现用户级AI智能体，扩展三级架构概念到诗词解析场景。

### 用户级AI智能体 (User AI)

**角色定位**: 每个用户的“专属诗词导师”。

**核心职责 (工作者Agent, MVP)**

- **个性化解析计划**: 根据用户进度、兴趣推荐基本路径。
- **学习进度督促**: 跟踪解析提交、提醒落后。
- **知识库问答与辅导**: 基于RAG解答疑问，提供意象解释、结构分析。
- **学习成果总结**: 生成周报，包含浏览时长、任务完成。
- **与资源集成**: 初步记录讨论数据，反馈给用户。

**输入信息**

- 诗词信息、原文、注释（RAG知识库）。
- 用户学习记录、解析提交、互动成绩、行为数据。
- 用户目标与偏好。

**输出信息**

- 个性化解析计划。
- 进度报告与预警。
- 即时解答与辅导。
- 学习成果报告。

(教师级与平台级AI在后续阶段扩展。)

## 🔄 数据流设计 (H: Hyper-scalable Data, MVP)

数据层作为真理之源，通过事件驱动演化。

### 数据流向图 (MVP)

```
用户操作 (用户/教师)
     ↓
前端 (Next.js) <=> Vercel Edge Functions (API & 鉴权)
     ↓
Lean Backend (FastAPI - 敏感操作)
     ↓
Supabase (PostgreSQL, RLS, Realtime)
     ↑     ↓
Supabase Edge Functions / Triggers (内生逻辑)
     ↓
n8n (用户AI编排)
     ↓ (LLM API calls)
外部LLM (OpenAI)
     ↓
LLM响应 → n8n → Supabase更新
     ↓
Supabase Realtime (通知前端)
     ↑
外部资源数据流 (初步集成)
```

### 关键数据表结构 (MVP核心)

新增以下表 (基于现有文学平台表)：

1. **users**: 用户基本信息、兴趣标签。
2. **poems**: 诗词信息、原文、朝代。
3. **enrollments**: 选诗记录。
4. **interpretations**: 解析详情、提交状态。
5. **scores**: 解析成绩记录。
6. **learning_paths**: AI生成的解析计划。
7. **knowledge_base_chunks**: 知识库切片 + pgvector嵌入。
8. **user_learning_activities**: 学习行为记录。
9. **ai_agent_state**: Agent记忆 (Belief DSL)。

### 数据层关键实践 (MVP)

- **RAG基础设施**: pgvector存储原文、注释，形成基础知识库。
- **内生逻辑**: Triggers触发低分提醒。
- **实时引擎**: Realtime推送解析更新。

## 🎨 用户界面设计理念 (I: Intelligent Frontend, MVP)

### 设计原则

1. **角色化定制**: 用户/教师专属UI。
2. **AI驱动洞察**: 突出AI建议。
3. **沉浸式体验**: 聊天交互。
4. **数据可视化**: 基本图表。
5. **统一品牌**: 与外部资源一致。

### 核心页面设计 (MVP)

#### 1. 用户主工作台 (User Dashboard)

**布局**: 左侧导航 + 中部计划/进度 + 右侧AI聊天窗口。

**功能**:

- 个性化解析计划: 显示诗词、任务。
- 学习进度总览: 掌握度、活跃度图表。
- AI导师: 聊天问答、督促。
- 学习资源: 访问原文、注释。

**特色**: AI主动提醒低活跃。

#### 2. 教师教学管理台 (Teacher Dashboard, MVP基本)

**布局**: 顶部筛选 + 左侧课堂列表 + 中部用户看板。

**功能**:

- 课堂学情概览: 整体理解进度、平均准确率。
- 用户个体画像: 查看AI报告。
- 风险预警: 高亮误解用户。
- 解析管理: 基本查看提交。

**特色**: 支持查看用户AI互动记录。

## 🚀 性能优化策略 (跨域护栏: 可观测性与成本控制, MVP基础)

### 1. 数据库优化 (H)

- 索引: 用户ID、时间戳。
- pgvector: HNSW加速检索。

### 2. AI层面优化 (T & L)

- **成本感知路由**: 简单问题用廉价模型。
- **Prompt优化**: 精炼减少Token。
- **缓存**: 重复响应缓存。
- **TTFT**: <1s目标，利用流式传输。

### 3. 可观测性 (Observability)

- **全链路Trace**: Vercel AI Gateway记录AI交互。
- **核心指标**: 质量(幻觉率)、延迟(P50/P95)、成本(CPCQ)。
- **自定义告警**: 指标超阈值触发。

### 4. 成本控制

- **预算警报**: LLM调用超支熔断。
- **双轨路由**: 简单交互快轨。
- **配额管理**: 用户AI资源限额。

## 🔐 安全与权限设计 (跨域护栏: 安全与合规, MVP)

### 1. 数据安全与隐私

- **RLS**: 用户仅自数据，教师限课堂。
- **数据脱敏**: 聚合分析脱敏。
- **审计日志**: AI交互记录。

### 2. AI安全

- **Prompt注入防护**: Backend过滤。
- **输出过滤**: 敏感词检查。
- **Human-in-the-loop**: 关键计划教师审核。

### 3. 认证与授权

- **统一认证**: 与文化系统对接，JWT。
- **角色**: 用户、教师、管理员。
- **权限粒度**: 课堂-诗词-个人。

## 📊 项目进度与里程碑 (MVP聚焦阶段一)

### 阶段一：核心用户解析助手 MVP (约 3个月)

1. **用户与身份整合**: 与现有系统对接。
2. **核心数据库搭建**: 导入用户、诗词数据到Supabase。
3. **RAG知识库建设**: 原文、注释嵌入pgvector。
4. **用户AI解析助手 (MVP)**:
   - 前端UI: 聊天与计划展示。
   - AI: RAG问答、进度查询、计划推荐。
   - 数据流: AI与Supabase交互。
5. **教师查看记录 (MVP)**: 查看用户进度/AI记录。
6. **安全与可观测性**: RLS、防护、Trace、成本监控。

(后续阶段二/三扩展。)

## 🎯 成功指标与评估 (MVP)

### 技术指标

- **页面加载**: <500ms (P90)
- **AI响应 (TTFT)**: <1s (P90)
- **RAG准确率**: >90%
- **可用性**: 99.9%
- **并发**: 支持500+用户

### 业务指标

- **用户活跃度**: 日活跃率>30%，AI使用频率。
- **解析准确率提升**: 误解率下降5%。
- **教师效率**: 学情分析时间减半。
- **知识库使用**: 检索解决问题>80%。
- **采纳率**: 用户满意度>80%。

### 用户体验指标

- **满意度**: AI导师评分>4/5。
- **学习曲线**: 上手<5min。
- **错误率**: <1%。

## 🔮 未来发展方向 (MVP后)

### 短期目标 (3-6个月)

- 完善用户AI行为 (Belief DSL迭代)。
- 初步资源集成。
- 性能监控仪表盘。

### 中期/长期愿景

- 扩展三级AI、多模态。
- 深度资源融合、移动优化。
- AI原生文化、跨平台合作。

## 📝 总结

“诗韵星”MVP是古典诗词文化AI变革的起点。通过L.I.G.H.T.架构，我们构建高效用户解析系统：个性化辅导、智能督促。后续迭代将扩展全生态，照亮用户文化之路。

**文档版本**: v1.0 MVP | **最后更新**: 2025-10-14 | **编写者**: AI助手 (基于L.I.G.H.T.架构)