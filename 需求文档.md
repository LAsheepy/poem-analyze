# 🌟 诗韵星 (Rhyme Star) AI驱动诗词解析平台 - 增强MVP版本项目设计文档

## 📋 文档信息

- **文档版本**: v1.1 增强MVP
- **创建日期**: 2025-10-14
- **文档类型**: 项目设计文档 (增强MVP版)
- **编写视角**: 项目技术负责人/产品经理视角
- **目标读者**: 项目团队、技术负责人、AI专家、文学教育从业者

## 🎯 项目概述

### 项目愿景

构建一个以用户为中心、AI赋能的诗词解析与欣赏生态系统增强MVP，通过整合用户级AI智能体，为古典诗词爱好者、学生和教师提供个性化解析支持、互动学习体验。本增强MVP聚焦核心用户解析助手，强调美观设计与动态效果，与现有文学教育资源平台（如古诗文网）初步融合，实现诗词文化传承的初步智能化。新增多栏目展示更多诗词资源，并支持跳转到详尽解析页面，提供更丰富的文化内容。

### 核心价值主张 (增强MVP聚焦)

1. **个性化解析赋能**: AI为用户定制基本解析路径，提供即时解释与动态视觉辅助。
2. **教学互动增效**: 教师查看用户学情，减少重复解析工作，支持互动讨论。
3. **知识积累**: 沉淀诗词资源，构建扩展知识库，包括作者生平、历史背景。
4. **无缝集成外部资源**: 初步统一诗词学习与文化实践数据。
5. **美观与互动体验**: 通过动态效果和多栏目设计，提升沉浸式欣赏与学习乐趣。

## 🏗️ 系统架构设计 - 基于“灯塔” (L.I.G.H.T.) 架构模式 v3.0 (增强MVP简化)

本增强MVP严格遵循L.I.G.H.T.架构核心哲学：最少后端、最强前端智能、Git驱动协作、可伸缩数据层与模板化AI智能体，交付安全、可观测的系统。新增前端动态效果支持（如Framer Motion动画库）。

**核心哲学**：聚焦用户AI导师，简化到核心组件，增强视觉与交互层。

### 整体架构图 (增强MVP版)

```
┌─────────────────────────────────────────────────────────────┐
│                    前端应用层 (Intelligent Frontend - I)        │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ 用户解析UI │  │ 教师互动UI │                               │
│ └──────────┘  └──────────┘                                   │
│       (Next.js, Vercel AI SDK, Framer Motion)                │
├─────────────────────────────────────────────────────────────┤
│                    API接口层 (Lean Backend - L)                 │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │  统一鉴权  │  │ 敏感数据  │                                 │
│ └──────────┘  └──────────┘                                   │
│        (FastAPI, Vercel Functions)                           │
├─────────────────────────────────────────────────────────────┤
│                  AI编排与业务流程 (Templated AI Agents - T)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐                                                 │
│ │ 用户级AI  │                                                │
│ └──────────┘                                                 │
│       (n8n, LangGraph, Belief DSL (YAML))                     │
├─────────────────────────────────────────────────────────────┤
│                    超大规模数据层 (Hyper-scalable Data - H)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ Supabase  │  │ pgvector  │                                  │
│ │ (PostgreSQL)│  │ (RAG KB)  │                               │
│ └──────────┘  └──────────┘                                   │
├─────────────────────────────────────────────────────────────┤
│                    Git驱动工作流 (Git-driven Workflow - G)    │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────┐  ┌──────────┐                                   │
│ │ Monorepo  │  │ CI/CD     │                                  │
│ └──────────┘  └──────────┘                                   │
│       (GitHub, Vercel, Turborepo)                            │
└─────────────────────────────────────────────────────────────┘
```

### 技术架构特点 (增强MVP)

- **Monorepo 统一管理**: 与现有文学资源代码共享，简化协作。
- **Serverless优先**: Vercel Functions按需伸缩。
- **AI编排核心**: n8n连接用户AI与数据源。
- **Supabase 中心**: PostgreSQL + pgvector构建扩展RAG知识库（新增作者生平、历史背景），Realtime实时同步。
- **智能化前端**: Next.js + Vercel AI SDK + Framer Motion，提供动态动画（如诗词滚动吟诵效果、卡片翻转解析）。

## 🧠 AI智能体架构 (T: Templated AI Agents, 增强MVP聚焦用户级)

增强MVP仅实现用户级AI智能体，扩展三级架构概念到诗词解析场景。AI输出支持更详细内容生成（如多层解析：字词、意象、整体）。

### 用户级AI智能体 (User AI)

**角色定位**: 每个用户的“专属诗词导师”。

**核心职责 (工作者Agent, 增强MVP)**

- **个性化解析计划**: 根据用户进度、兴趣推荐基本路径，支持动态调整。
- **学习进度督促**: 跟踪解析提交、提醒落后，结合动画反馈。
- **知识库问答与辅导**: 基于扩展RAG解答疑问，提供意象解释、结构分析、作者生平、历史背景。
- **学习成果总结**: 生成周报，包含浏览时长、任务完成、相关诗词推荐。
- **与资源集成**: 初步记录讨论数据，反馈给用户，支持跳转详尽解析。

**输入信息**

- 诗词信息、原文、注释、作者生平、历史背景（扩展RAG知识库）。
- 用户学习记录、解析提交、互动成绩、行为数据。
- 用户目标与偏好。

**输出信息**

- 个性化解析计划（含多诗词推荐）。
- 进度报告与预警。
- 即时解答与辅导（分层详细内容）。
- 学习成果报告（含可视化图表）。

(教师级与平台级AI在后续阶段扩展。)

## 🔄 数据流设计 (H: Hyper-scalable Data, 增强MVP)

数据层作为真理之源，通过事件驱动演化。扩展知识库支持更多诗词内容。

### 数据流向图 (增强MVP)

```
用户操作 (用户/教师)
     ↓
前端 (Next.js + Animations) <=> Vercel Edge Functions (API & 鉴权)
     ↓
Lean Backend (FastAPI - 敏感操作)
     ↓
Supabase (PostgreSQL, RLS, Realtime)
     ↑     ↓
Supabase Edge Functions / Triggers (内生逻辑)
     ↓
n8n (用户AI编排)
     ↓ (LLM API calls)
外部LLM (OpenAI)
     ↓
LLM响应 → n8n → Supabase更新
     ↓
Supabase Realtime (通知前端)
     ↑
外部资源数据流 (初步集成)
```

### 关键数据表结构 (增强MVP核心)

新增/扩展以下表 (基于现有文学平台表)：

1. **users**: 用户基本信息、兴趣标签。
2. **poems**: 诗词信息、原文、朝代（扩展：作者生平、相关诗词链接）。
3. **enrollments**: 选诗记录。
4. **interpretations**: 解析详情、提交状态（扩展：分层内容 - 字词/意象/整体）。
5. **scores**: 解析成绩记录。
6. **learning_paths**: AI生成的解析计划（含多诗词路径）。
7. **knowledge_base_chunks**: 知识库切片 + pgvector嵌入（扩展：背景、评论）。
8. **user_learning_activities**: 学习行为记录（含互动时长）。
9. **ai_agent_state**: Agent记忆 (Belief DSL)。

### 数据层关键实践 (增强MVP)

- **RAG基础设施**: pgvector存储原文、注释、作者生平、历史背景，形成扩展知识库，支持更多诗词检索。
- **内生逻辑**: Triggers触发低分提醒、相关诗词推荐。
- **实时引擎**: Realtime推送解析更新、动态内容加载。

## 🎨 用户界面设计理念 (I: Intelligent Frontend, 增强MVP)

### 设计原则

1. **角色化定制**: 用户/教师专属UI，响应式设计适配移动/桌面。
2. **AI驱动洞察**: 突出AI建议，结合动态效果（如淡入动画）。
3. **沉浸式体验**: 聊天交互 + 诗词主题视觉（水墨风背景、滚动诗句动画）。
4. **数据可视化**: 基本图表 + 动态卡片展示更多诗词。
5. **统一品牌**: 与外部资源一致，新增Framer Motion实现翻转/悬停效果。

### 核心页面设计 (增强MVP)

#### 1. 用户主工作台 (User Dashboard)

**布局**: 左侧导航（新增栏目：诗词库、推荐、分类浏览） + 中部计划/进度 + 右侧AI聊天窗口。

**功能**:

- **个性化解析计划**: 显示诗词、任务，支持多诗词卡片轮播（动态滑动效果）。
- **学习进度总览**: 掌握度、活跃度图表，新增“今日诗词推荐”栏目（展示5-10首诗，点击跳转详尽解析）。
- **AI导师**: 聊天问答、督促，支持语音吟诵动画。
- **学习资源**: 访问原文、注释，新增“诗词瀑布流”栏目（网格布局展示更多诗词，按朝代/主题分类）。
- **详尽解析跳转**: 从列表/推荐点击，跳转独立页面（含原文动画展示、AI分层解析、相关诗词链接）。

**特色**: AI主动提醒低活跃（弹窗动画），诗词卡片悬停翻转显示预览。

#### 2. 教师教学管理台 (Teacher Dashboard, 增强基本)

**布局**: 顶部筛选 + 左侧课堂列表 + 中部用户看板 + 新增“诗词资源管理”栏目。

**功能**:

- **课堂学情概览**: 整体理解进度、平均准确率，动态柱状图动画。
- **用户个体画像**: 查看AI报告，支持导出。
- **风险预警**: 高亮误解用户，新增批量跳转详尽解析。
- **解析管理**: 基本查看提交，新增“共享诗词库”栏目（教师上传/编辑更多诗词内容）。

**特色**: 支持查看用户AI互动记录，动态通知铃铛效果。

#### 3. 新增：详尽诗词解析页面 (Detailed Poem Analysis Page)

**布局**: 全屏沉浸式 - 上部原文动画展示 + 中部分层解析 + 下部相关内容。

**功能**:

- **原文展示**: 动态滚动吟诵（文字渐现动画），支持音频播放。
- **分层解析**: AI生成详细内容（字词解释、意象分析、整体赏析、作者生平、历史背景）。
- **互动扩展**: 相关诗词推荐（卡片列表，点击跳转）、用户笔记、讨论区。
- **可视化**: 时间线图表展示诗词创作背景，动态意象图标。

**特色**: 背景水墨渐变动画，解析内容折叠/展开效果，提升沉浸感。

## 🚀 性能优化策略 (跨域护栏: 可观测性与成本控制, 增强MVP基础)

### 1. 数据库优化 (H)

- 索引: 用户ID、时间戳、诗词ID。
- pgvector: HNSW加速检索，支持扩展内容查询。

### 2. AI层面优化 (T & L)

- **成本感知路由**: 简单问题用廉价模型，详细解析路由强大模型。
- **Prompt优化**: 精炼减少Token，针对分层内容定制Prompt。
- **缓存**: 重复响应/诗词预览缓存。
- **TTFT**: <1s目标，利用流式传输 + 动画加载占位。

### 3. 可观测性 (Observability)

- **全链路Trace**: Vercel AI Gateway记录AI交互，包括动态效果触发。
- **核心指标**: 质量(幻觉率)、延迟(P50/P95)、成本(CPCQ)、动画帧率。
- **自定义告警**: 指标超阈值触发（如解析加载慢）。

### 4. 成本控制

- **预算警报**: LLM调用超支熔断。
- **双轨路由**: 简单交互快轨，详尽解析质轨。
- **配额管理**: 用户AI资源限额，动态效果不计入。

## 🔐 安全与权限设计 (跨域护栏: 安全与合规, 增强MVP)

### 1. 数据安全与隐私

- **RLS**: 用户仅自数据，教师限课堂，详尽解析页权限控制。
- **数据脱敏**: 聚合分析脱敏。
- **审计日志**: AI交互 + 动态内容访问记录。

### 2. AI安全

- **Prompt注入防护**: Backend过滤。
- **输出过滤**: 敏感词检查，文化内容合规。
- **Human-in-the-loop**: 关键计划/详尽解析教师审核。

### 3. 认证与授权

- **统一认证**: 与文化系统对接，JWT。
- **角色**: 用户、教师、管理员。
- **权限粒度**: 课堂-诗词-个人，详尽页需登录。

## 📊 项目进度与里程碑 (增强MVP聚焦阶段一)

### 阶段一：核心用户解析助手增强MVP (约 3个月)

1. **用户与身份整合**: 与现有系统对接。
2. **核心数据库搭建**: 导入用户、诗词数据到Supabase（扩展内容）。
3. **RAG知识库建设**: 原文、注释、背景嵌入pgvector。
4. **用户AI解析助手 (增强MVP)**:
   - 前端UI: 聊天 + 动态动画 + 多栏目展示。
   - AI: RAG问答、进度查询、计划推荐、分层详细内容。
   - 数据流: AI与Supabase交互，支持跳转详尽页。
5. **教师查看记录 (增强MVP)**: 查看用户进度/AI记录 + 资源管理。
6. **安全与可观测性**: RLS、防护、Trace、成本监控。

(后续阶段二/三扩展。)

## 🎯 成功指标与评估 (增强MVP)

### 技术指标

- **页面加载**: <500ms (P90)，动画流畅>60fps。
- **AI响应 (TTFT)**: <1s (P90)。
- **RAG准确率**: >90%（扩展内容覆盖）。
- **可用性**: 99.9%。
- **并发**: 支持500+用户。

### 业务指标

- **用户活跃度**: 日活跃率>30%，AI使用频率，诗词浏览量>原2倍。
- **解析准确率提升**: 误解率下降5%。
- **教师效率**: 学情分析时间减半。
- **知识库使用**: 检索解决问题>80%，详尽页访问率>50%。
- **采纳率**: 用户满意度>80%（含设计反馈）。

### 用户体验指标

- **满意度**: AI导师 + 动态效果评分>4.5/5。
- **学习曲线**: 上手<5min。
- **错误率**: <1%。

## 🔮 未来发展方向 (增强MVP后)

### 短期目标 (3-6个月)

- 完善用户AI行为 (Belief DSL迭代)。
- 初步资源集成 + 更多动态效果优化。
- 性能监控仪表盘。

### 中期/长期愿景

- 扩展三级AI、多模态（语音吟诵动画）。
- 深度资源融合、移动优化。
- AI原生文化、跨平台合作。

## 📝 总结

“诗韵星”增强MVP是古典诗词文化AI变革的起点。通过L.I.G.H.T.架构与美观动态设计，我们构建高效用户解析系统：个性化辅导、智能督促、多栏目展示、详尽内容跳转。后续迭代将扩展全生态，照亮用户文化之路。

**文档版本**: v1.1 增强MVP | **最后更新**: 2025-10-14 | **编写者**: AI助手 (基于L.I.G.H.T.架构)