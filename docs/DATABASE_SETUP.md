# 数据库设置指南

## 1. 数据库表结构

本项目使用Supabase作为后端数据库，包含以下主要表：

### 用户表 (users)
- 存储用户基本信息、学习进度和统计数据
- 包含角色管理（学生/教师）

### 诗词表 (poems) 
- 存储诗词内容、作者、朝代等信息
- 支持难度分级和标签分类

### 诗词解析表 (poem_analyses)
- 存储用户对诗词的解析结果
- 包含字词分析、意象分析、整体分析等

### 学习记录表 (learning_records)
- 记录用户的学习历史和进度
- 包含学习时间、得分、完成状态等

### AI对话表 (ai_conversations)
- 管理用户与AI的对话会话
- 关联具体诗词（可选）

### AI消息表 (ai_messages)
- 存储对话中的具体消息内容
- 区分用户和AI角色

## 2. 数据库函数

### 自动更新函数
- `update_updated_at_column()` - 自动更新时间戳

### 业务函数
- `increment_views(poem_id)` - 增加诗词浏览量
- `increment_likes(poem_id)` - 增加诗词点赞数

## 3. 安全策略

启用行级安全策略(RLS)，确保：
- 用户只能访问和修改自己的数据
- 所有用户可以查看诗词内容
- 严格的权限控制保护用户隐私

## 4. 部署步骤

1. 在Supabase控制台创建新项目
2. 运行SQL迁移脚本
3. 配置环境变量
4. 测试数据库连接

## 5. 示例数据

迁移脚本包含示例诗词数据，便于开发和测试：
- 4首经典唐诗
- 2个演示用户账户

## 6. 性能优化

- 为常用查询字段创建索引
- 使用GIN索引支持数组查询
- 合理的表关联设计