import{a as O,O as Q,d as X,k as Y,P as Z,g as ss}from"./element-plus-21ed9e7d.js";import{q as ts,r as S,c as es,z as as,D as c,E as s,U as a,W as _,P as m,V as y,ak as f,T as d,bD as os,bz as ns,C as r,u as L,O as ls}from"./vendor-0fc5911b.js";import{g as R,a as U}from"./mockData-3b1561c6.js";import{s as h,_ as is}from"./index-044b3288.js";import"./supabase-043902eb.js";const rs={class:"analysis-page"},cs={class:"page-header"},ds={class:"header-content"},us={class:"poem-info"},_s={class:"poem-title"},ms={class:"poem-meta"},vs={class:"author"},ps={class:"dynasty"},ys={class:"header-actions"},fs={class:"main-content"},hs={class:"analysis-layout"},gs={class:"poem-section"},ks={class:"section-card"},ws={class:"poem-content"},bs={class:"section-card"},xs={class:"line-analysis"},As={class:"line-text"},Ds={class:"line-meaning"},Es={class:"analysis-section"},Is={class:"section-card"},Cs={class:"analysis-content"},Ps={class:"section-card"},Bs={class:"imagery-analysis"},Ts={class:"section-card"},Vs={class:"author-info"},zs={class:"works"},Ms={class:"section-card"},qs={class:"historical-context"},Ns=ts({__name:"Analysis",setup(Os){const $=os();ns();const n=S(null),l=S(null),u=es(()=>$.params.id);as(async()=>{await F()});const F=async()=>{try{const{data:e,error:t}=await h.from("poems").select("*").eq("id",u.value).single();if(t){console.error("加载诗词失败:",t);const i=R();n.value=i.find(v=>v.id===u.value)||i[0]}else n.value=e;l.value=U(u.value),await K()}catch(e){console.error("加载诗词数据异常:",e);const t=R();n.value=t.find(i=>i.id===u.value)||t[0],l.value=U(u.value)}},W=e=>({easy:"success",medium:"warning",hard:"danger"})[e]||"info",j=e=>({easy:"简单",medium:"中等",hard:"困难"})[e]||"未知",G=e=>{var i;const t=((i=l.value)==null?void 0:i.word_analysis)||[];return t[e]?`${t[e].character}：${t[e].meaning}`:"暂无详细解析"},H=()=>{console.log("AI聊天功能暂未实现")},J=async()=>{var e;try{const{error:t}=await h.from("user_analysis").upsert({user_id:(e=(await h.auth.getUser()).data.user)==null?void 0:e.id,poem_id:u.value,analysis_data:l.value,created_at:new Date().toISOString()});if(t)throw t;O.success("分析已保存")}catch(t){console.error("保存分析失败:",t),O.error("保存失败，请重试")}},K=async()=>{var e;try{await h.from("poems").update({views:(((e=n.value)==null?void 0:e.views)||0)+1}).eq("id",u.value)}catch(t){console.error("记录查看失败:",t)}};return(e,t)=>{var k,w,b,x,A,D,E,I,C,P,B,T,V,z,M,q,N;const i=Q,v=ss,g=X;return r(),c("div",rs,[s("div",cs,[s("div",ds,[s("div",us,[s("h1",_s,a((k=n.value)==null?void 0:k.title),1),s("div",ms,[s("span",vs,a((w=n.value)==null?void 0:w.author),1),s("span",ps,a((b=n.value)==null?void 0:b.dynasty),1),_(i,{type:W((x=n.value)==null?void 0:x.difficulty),size:"small"},{default:m(()=>{var o;return[d(a(j((o=n.value)==null?void 0:o.difficulty)),1)]}),_:1},8,["type"])])]),s("div",ys,[_(g,{type:"primary",onClick:H},{default:m(()=>[_(v,null,{default:m(()=>[_(L(Y))]),_:1}),t[0]||(t[0]=d(" 与AI讨论 ",-1))]),_:1}),_(g,{onClick:J},{default:m(()=>[_(v,null,{default:m(()=>[_(L(Z))]),_:1}),t[1]||(t[1]=d(" 保存分析 ",-1))]),_:1})])])]),s("div",fs,[s("div",hs,[s("div",gs,[s("div",ks,[t[2]||(t[2]=s("h3",{class:"section-title"},"诗词原文",-1)),s("div",ws,[(r(!0),c(y,null,f((A=n.value)==null?void 0:A.content,(o,p)=>(r(),c("p",{key:p,class:"poem-line"},a(o),1))),128))])]),s("div",bs,[t[3]||(t[3]=s("h3",{class:"section-title"},"逐句解析",-1)),s("div",xs,[(r(!0),c(y,null,f((D=n.value)==null?void 0:D.content,(o,p)=>(r(),c("div",{key:p,class:"line-item"},[s("div",As,a(o),1),s("div",Ds,a(G(p)),1)]))),128))])])]),s("div",Es,[s("div",Is,[t[4]||(t[4]=s("h3",{class:"section-title"},"整体分析",-1)),s("div",Cs,[s("p",null,a((E=l.value)==null?void 0:E.overall_analysis),1)])]),s("div",Ps,[t[7]||(t[7]=s("h3",{class:"section-title"},"意象分析",-1)),s("div",Bs,[(r(!0),c(y,null,f((I=l.value)==null?void 0:I.imagery_analysis,o=>(r(),c("div",{key:o.name,class:"imagery-item"},[s("h4",null,a(o.name),1),s("p",null,[t[5]||(t[5]=s("strong",null,"描述：",-1)),d(a(o.description),1)]),s("p",null,[t[6]||(t[6]=s("strong",null,"象征意义：",-1)),d(a(o.symbolism),1)])]))),128))])]),s("div",Ts,[t[11]||(t[11]=s("h3",{class:"section-title"},"作者信息",-1)),s("div",Vs,[s("h4",null,a((P=(C=l.value)==null?void 0:C.author_info)==null?void 0:P.name),1),s("p",null,[t[8]||(t[8]=s("strong",null,"朝代：",-1)),d(a((T=(B=l.value)==null?void 0:B.author_info)==null?void 0:T.dynasty),1)]),s("p",null,[t[9]||(t[9]=s("strong",null,"简介：",-1)),d(a((z=(V=l.value)==null?void 0:V.author_info)==null?void 0:z.biography),1)]),s("div",zs,[t[10]||(t[10]=s("strong",null,"代表作品：",-1)),(r(!0),c(y,null,f((q=(M=l.value)==null?void 0:M.author_info)==null?void 0:q.works,o=>(r(),ls(i,{key:o,size:"small",style:{margin:"2px 4px"}},{default:m(()=>[d(a(o),1)]),_:2},1024))),128))])])]),s("div",Ms,[t[12]||(t[12]=s("h3",{class:"section-title"},"历史背景",-1)),s("div",qs,[s("p",null,a((N=l.value)==null?void 0:N.historical_context),1)])])])])])])}}});const Fs=is(Ns,[["__scopeId","data-v-bba167cd"]]);export{Fs as default};
