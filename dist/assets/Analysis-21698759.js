import{d as Y,g as q,G as Z,h as ss,L as y,c as d,b as s,t as a,a as _,w as v,F as f,n as h,m as u,M as ts,k as es,K as z,r as g,o as r,e as F,N as as,O as os,j as ns,_ as ls}from"./main-3abf4ed4.js";import{g as O,a as R}from"./mockData-70ed22ed.js";const is={class:"analysis-page"},rs={class:"page-header"},cs={class:"header-content"},ds={class:"poem-info"},us={class:"poem-title"},_s={class:"poem-meta"},vs={class:"author"},ms={class:"dynasty"},ps={class:"header-actions"},ys={class:"page-content"},fs={class:"analysis-layout"},hs={class:"poem-section"},gs={class:"section-card"},ws={class:"poem-content"},ks={class:"section-card"},xs={class:"line-analysis"},As={class:"line-text"},bs={class:"line-meaning"},Cs={class:"analysis-section"},Ds={class:"section-card"},Is={class:"analysis-content"},Ms={class:"section-card"},Bs={class:"imagery-analysis"},Ns={class:"section-card"},Ps={class:"author-info"},Vs={class:"works"},Es={class:"section-card"},Ls={class:"historical-context"},Ss=Y({__name:"Analysis",setup(Ts){const j=ts(),G=es(),n=q(null),l=q(null),c=Z(()=>j.params.id);ss(async()=>{await K()});const K=async()=>{try{const{data:e,error:t}=await y.from("poems").select("*").eq("id",c.value).single();if(t){console.error("加载诗词失败:",t);const i=O();n.value=i.find(m=>m.id===c.value)||i[0]}else n.value=e;l.value=R(c.value),await X()}catch(e){console.error("加载诗词数据异常:",e);const t=O();n.value=t.find(i=>i.id===c.value)||t[0],l.value=R(c.value)}},U=e=>({easy:"success",medium:"warning",hard:"danger"})[e]||"info",H=e=>({easy:"简单",medium:"中等",hard:"困难"})[e]||"未知",J=e=>{var i;const t=((i=l.value)==null?void 0:i.word_analysis)||[];return t[e]?`${t[e].character}：${t[e].meaning}`:"暂无详细解析"},Q=()=>{G.push(`/chat?poem=${c.value}`)},W=async()=>{var e;try{const{error:t}=await y.from("user_analysis").upsert({user_id:(e=(await y.auth.getUser()).data.user)==null?void 0:e.id,poem_id:c.value,analysis_data:l.value,created_at:new Date().toISOString()});if(t)throw t;z.success("分析已保存")}catch(t){console.error("保存分析失败:",t),z.error("保存失败，请重试")}},X=async()=>{var e;try{await y.from("poems").update({views:(((e=n.value)==null?void 0:e.views)||0)+1}).eq("id",c.value)}catch(t){console.error("记录查看失败:",t)}};return(e,t)=>{var k,x,A,b,C,D,I,M,B,N,P,V,E,L,S,T,$;const i=g("el-tag"),m=g("el-icon"),w=g("el-button");return r(),d("div",is,[s("div",rs,[s("div",cs,[s("div",ds,[s("h1",us,a((k=n.value)==null?void 0:k.title),1),s("div",_s,[s("span",vs,a((x=n.value)==null?void 0:x.author),1),s("span",ms,a((A=n.value)==null?void 0:A.dynasty),1),_(i,{type:U((b=n.value)==null?void 0:b.difficulty),size:"small"},{default:v(()=>{var o;return[u(a(H((o=n.value)==null?void 0:o.difficulty)),1)]}),_:1},8,["type"])])]),s("div",ps,[_(w,{type:"primary",onClick:Q},{default:v(()=>[_(m,null,{default:v(()=>[_(F(as))]),_:1}),t[0]||(t[0]=u(" 与AI讨论 ",-1))]),_:1}),_(w,{onClick:W},{default:v(()=>[_(m,null,{default:v(()=>[_(F(os))]),_:1}),t[1]||(t[1]=u(" 保存分析 ",-1))]),_:1})])])]),s("div",ys,[s("div",fs,[s("div",hs,[s("div",gs,[t[2]||(t[2]=s("h3",{class:"section-title"},"诗词原文",-1)),s("div",ws,[(r(!0),d(f,null,h((C=n.value)==null?void 0:C.content,(o,p)=>(r(),d("p",{key:p,class:"poem-line"},a(o),1))),128))])]),s("div",ks,[t[3]||(t[3]=s("h3",{class:"section-title"},"逐句解析",-1)),s("div",xs,[(r(!0),d(f,null,h((D=n.value)==null?void 0:D.content,(o,p)=>(r(),d("div",{key:p,class:"line-item"},[s("div",As,a(o),1),s("div",bs,a(J(p)),1)]))),128))])])]),s("div",Cs,[s("div",Ds,[t[4]||(t[4]=s("h3",{class:"section-title"},"整体分析",-1)),s("div",Is,[s("p",null,a((I=l.value)==null?void 0:I.overall_analysis),1)])]),s("div",Ms,[t[7]||(t[7]=s("h3",{class:"section-title"},"意象分析",-1)),s("div",Bs,[(r(!0),d(f,null,h((M=l.value)==null?void 0:M.imagery_analysis,o=>(r(),d("div",{key:o.name,class:"imagery-item"},[s("h4",null,a(o.name),1),s("p",null,[t[5]||(t[5]=s("strong",null,"描述：",-1)),u(a(o.description),1)]),s("p",null,[t[6]||(t[6]=s("strong",null,"象征意义：",-1)),u(a(o.symbolism),1)])]))),128))])]),s("div",Ns,[t[11]||(t[11]=s("h3",{class:"section-title"},"作者信息",-1)),s("div",Ps,[s("h4",null,a((N=(B=l.value)==null?void 0:B.author_info)==null?void 0:N.name),1),s("p",null,[t[8]||(t[8]=s("strong",null,"朝代：",-1)),u(a((V=(P=l.value)==null?void 0:P.author_info)==null?void 0:V.dynasty),1)]),s("p",null,[t[9]||(t[9]=s("strong",null,"简介：",-1)),u(a((L=(E=l.value)==null?void 0:E.author_info)==null?void 0:L.biography),1)]),s("div",Vs,[t[10]||(t[10]=s("strong",null,"代表作品：",-1)),(r(!0),d(f,null,h((T=(S=l.value)==null?void 0:S.author_info)==null?void 0:T.works,o=>(r(),ns(i,{key:o,size:"small",style:{margin:"2px 4px"}},{default:v(()=>[u(a(o),1)]),_:2},1024))),128))])])]),s("div",Es,[t[12]||(t[12]=s("h3",{class:"section-title"},"历史背景",-1)),s("div",Ls,[s("p",null,a(($=l.value)==null?void 0:$.historical_context),1)])])])])])])}}});const zs=ls(Ss,[["__scopeId","data-v-24ef59f3"]]);export{zs as default};
