import{a as u,q as os,O as ls,d as is,R as ns,S as rs,T as cs,U as ds,s as _s,r as us,V as vs,g as ps}from"./element-plus-7b99588a.js";import{q as fs,r as y,z as gs,D as g,E as s,W as a,P as l,U as o,V as H,ak as W,bz as ms,C as f,T as c,u as v,O as hs}from"./vendor-0fc5911b.js";import{b as m}from"./mockData-3b1561c6.js";import{s as w,_ as ys}from"./index-e8e1e544.js";import"./supabase-043902eb.js";const ws={class:"profile-page"},ks={class:"profile-content"},bs={class:"profile-layout"},Ds={class:"profile-sidebar"},Ss={class:"user-card"},xs={class:"user-avatar"},Cs={class:"user-info"},Ps={class:"username"},zs={class:"user-email"},Es={class:"stats-card"},Ts={class:"stats-grid"},Us={class:"stat-item"},Is={class:"stat-value"},Os={class:"stat-item"},Bs={class:"stat-value"},Ns={class:"stat-item"},Rs={class:"stat-value"},Vs={class:"stat-item"},qs={class:"stat-value"},As={class:"quick-actions"},Ms={class:"actions-grid"},Ls={class:"profile-main"},$s={class:"section-card"},Fs={class:"progress-stats"},Hs={class:"progress-item"},Ws={class:"progress-info"},js={class:"progress-value"},Gs={class:"progress-item"},Js={class:"progress-info"},Ks={class:"progress-value"},Qs={class:"progress-item"},Xs={class:"progress-info"},Ys={class:"progress-value"},Zs={class:"section-card"},st={class:"activity-list"},tt={class:"activity-icon"},et={class:"activity-content"},at={class:"activity-title"},ot={class:"activity-time"},lt={class:"section-card"},it={class:"interest-tags"},nt={class:"section-card"},rt={class:"account-info"},ct={class:"info-item"},dt={class:"info-value"},_t={class:"info-item"},ut={class:"info-value"},vt={class:"info-item"},pt={class:"info-value"},ft=fs({__name:"Profile",setup(gt){const k=ms(),n=y(null),i=y(null),b=y([]);gs(async()=>{await j(),await G(),await J()});const j=async()=>{try{const{data:{user:e}}=await w.auth.getUser();if(e){const{data:t,error:d}=await w.from("profiles").select("*").eq("id",e.id).single();d?(console.error("加载用户资料失败:",d),n.value=m()):n.value={...e,...t}}else k.push("/login")}catch(e){console.error("加载用户资料异常:",e),n.value=m()}},G=async()=>{try{i.value=m()}catch(e){console.error("加载用户统计异常:",e),i.value=m()}},J=async()=>{try{b.value=[{id:"1",title:"解析了《静夜思》",created_at:new Date().toISOString()},{id:"2",title:"完成了唐诗学习任务",created_at:new Date(Date.now()-864e5).toISOString()},{id:"3",title:"收藏了《春晓》",created_at:new Date(Date.now()-1728e5).toISOString()}]}catch(e){console.error("加载活动记录异常:",e)}},K=e=>({student:"success",teacher:"warning",admin:"danger"})[e]||"info",Q=e=>({student:"学生",teacher:"教师",admin:"管理员"})[e]||"用户",X=()=>{u.info("编辑资料功能开发中")},Y=()=>{u.info("修改密码功能开发中")},Z=()=>{u.info("查看学习历史功能开发中")},ss=()=>{u.info("编辑兴趣功能开发中")},ts=async()=>{try{const{error:e}=await w.auth.signOut();if(e)throw e;u.success("退出登录成功"),k.push("/login")}catch(e){console.error("退出登录失败:",e),u.error("退出登录失败")}},es=e=>new Date(e).toLocaleString("zh-CN"),D=e=>e?new Date(e).toLocaleDateString("zh-CN"):"未知",as=e=>{if(!e)return"0分钟";const t=Math.floor(e/60),d=e%60;return t>0?`${t}小时${d}分钟`:`${d}分钟`};return(e,t)=>{var x,C,P,z,E,T,U,I,O,B,N,R,V,q,A,M,L,$;const d=os,S=ls,_=ps,p=is,h=ns;return f(),g("div",ws,[t[21]||(t[21]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"个人中心")],-1)),s("div",ks,[s("div",bs,[s("div",Ds,[s("div",Ss,[s("div",xs,[a(d,{size:80,src:(x=n.value)==null?void 0:x.avatar_url},{default:l(()=>{var r,F;return[c(o(((F=(r=n.value)==null?void 0:r.username)==null?void 0:F.charAt(0))||"U"),1)]}),_:1},8,["src"])]),s("div",Cs,[s("h2",Ps,o(((C=n.value)==null?void 0:C.username)||"用户"),1),s("p",zs,o((P=n.value)==null?void 0:P.email),1),a(S,{type:K((z=n.value)==null?void 0:z.role),size:"small"},{default:l(()=>{var r;return[c(o(Q((r=n.value)==null?void 0:r.role)),1)]}),_:1},8,["type"])])]),s("div",Es,[t[4]||(t[4]=s("h3",{class:"stats-title"},"学习统计",-1)),s("div",Ts,[s("div",Us,[s("div",Is,o(((E=i.value)==null?void 0:E.analyzed_poems)||0),1),t[0]||(t[0]=s("div",{class:"stat-label"},"已解析诗词",-1))]),s("div",Os,[s("div",Bs,o(((T=i.value)==null?void 0:T.streak_days)||0),1),t[1]||(t[1]=s("div",{class:"stat-label"},"连续学习天数",-1))]),s("div",Ns,[s("div",Rs,o(((U=i.value)==null?void 0:U.average_score)||0)+"%",1),t[2]||(t[2]=s("div",{class:"stat-label"},"平均得分",-1))]),s("div",Vs,[s("div",qs,o(((I=i.value)==null?void 0:I.mastery_level)||"初级"),1),t[3]||(t[3]=s("div",{class:"stat-label"},"掌握等级",-1))])])]),s("div",As,[t[9]||(t[9]=s("h3",{class:"actions-title"},"快捷操作",-1)),s("div",Ms,[a(p,{type:"primary",onClick:X},{default:l(()=>[a(_,null,{default:l(()=>[a(v(rs))]),_:1}),t[5]||(t[5]=c(" 编辑资料 ",-1))]),_:1}),a(p,{onClick:Y},{default:l(()=>[a(_,null,{default:l(()=>[a(v(cs))]),_:1}),t[6]||(t[6]=c(" 修改密码 ",-1))]),_:1}),a(p,{onClick:Z},{default:l(()=>[a(_,null,{default:l(()=>[a(v(ds))]),_:1}),t[7]||(t[7]=c(" 学习历史 ",-1))]),_:1}),a(p,{onClick:ts},{default:l(()=>[a(_,null,{default:l(()=>[a(v(_s))]),_:1}),t[8]||(t[8]=c(" 退出登录 ",-1))]),_:1})])])]),s("div",Ls,[s("div",$s,[t[13]||(t[13]=s("h3",{class:"section-title"},"学习进度",-1)),s("div",Fs,[s("div",Hs,[s("div",Ws,[t[10]||(t[10]=s("span",{class:"progress-label"},"总体进度",-1)),s("span",js,o(((O=i.value)==null?void 0:O.learning_progress)||0)+"%",1)]),a(h,{percentage:((B=i.value)==null?void 0:B.learning_progress)||0,"show-text":!1},null,8,["percentage"])]),s("div",Gs,[s("div",Js,[t[11]||(t[11]=s("span",{class:"progress-label"},"本周活跃度",-1)),s("span",Ks,o(((N=i.value)==null?void 0:N.weekly_activity)||0)+"%",1)]),a(h,{percentage:((R=i.value)==null?void 0:R.weekly_activity)||0,"show-text":!1,status:"success"},null,8,["percentage"])]),s("div",Qs,[s("div",Xs,[t[12]||(t[12]=s("span",{class:"progress-label"},"完成率",-1)),s("span",Ys,o(((V=i.value)==null?void 0:V.completion_rate)||0)+"%",1)]),a(h,{percentage:((q=i.value)==null?void 0:q.completion_rate)||0,"show-text":!1,status:"warning"},null,8,["percentage"])])])]),s("div",Zs,[t[14]||(t[14]=s("h3",{class:"section-title"},"最近活动",-1)),s("div",st,[(f(!0),g(H,null,W(b.value,r=>(f(),g("div",{key:r.id,class:"activity-item"},[s("div",tt,[a(_,null,{default:l(()=>[a(v(us))]),_:1})]),s("div",et,[s("div",at,o(r.title),1),s("div",ot,o(es(r.created_at)),1)])]))),128))])]),s("div",lt,[t[16]||(t[16]=s("h3",{class:"section-title"},"兴趣标签",-1)),s("div",it,[(f(!0),g(H,null,W(((A=n.value)==null?void 0:A.interests)||[],r=>(f(),hs(S,{key:r,type:"info",size:"large",class:"interest-tag"},{default:l(()=>[c(o(r),1)]),_:2},1024))),128)),a(p,{text:"",onClick:ss,class:"add-interest"},{default:l(()=>[a(_,null,{default:l(()=>[a(v(vs))]),_:1}),t[15]||(t[15]=c(" 添加兴趣 ",-1))]),_:1})])]),s("div",nt,[t[20]||(t[20]=s("h3",{class:"section-title"},"账户信息",-1)),s("div",rt,[s("div",ct,[t[17]||(t[17]=s("span",{class:"info-label"},"注册时间：",-1)),s("span",dt,o(D((M=n.value)==null?void 0:M.created_at)),1)]),s("div",_t,[t[18]||(t[18]=s("span",{class:"info-label"},"最后登录：",-1)),s("span",ut,o(D((L=n.value)==null?void 0:L.last_login_at)),1)]),s("div",vt,[t[19]||(t[19]=s("span",{class:"info-label"},"学习时长：",-1)),s("span",pt,o(as(($=i.value)==null?void 0:$.weekly_study_time)),1)])])])])])])])}}});const bt=ys(ft,[["__scopeId","data-v-e3a81f47"]]);export{bt as default};
