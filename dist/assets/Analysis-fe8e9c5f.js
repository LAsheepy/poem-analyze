import{s as y,_ as X}from"./index-1a553d90.js";/* empty css               */import{j as Y,r as S,c as Z,e as ss,l as d,t as s,E as _,z as m,F as f,$ as h,D as u,ai as ts,ae as es,k as r,u as q,y as as}from"./vendor-948b6be3.js";import{a1 as a,Q as F,as as os,T as ns,a5 as ls,at as is,W as rs}from"./element-plus-b9ba9950.js";import{g as L,a as R}from"./mockData-3b1561c6.js";import"./supabase-204daf22.js";const cs={class:"analysis-page"},ds={class:"page-header"},us={class:"header-content"},_s={class:"poem-info"},ms={class:"poem-title"},vs={class:"poem-meta"},ps={class:"author"},ys={class:"dynasty"},fs={class:"header-actions"},hs={class:"main-content"},gs={class:"analysis-layout"},ks={class:"poem-section"},ws={class:"section-card"},xs={class:"poem-content"},As={class:"section-card"},Ds={class:"line-analysis"},Es={class:"line-text"},Is={class:"line-meaning"},Bs={class:"analysis-section"},Cs={class:"section-card"},Ts={class:"analysis-content"},bs={class:"section-card"},Ms={class:"imagery-analysis"},Ps={class:"section-card"},Vs={class:"author-info"},$s={class:"works"},zs={class:"section-card"},Ns={class:"historical-context"},Ss=Y({__name:"Analysis",setup(qs){const j=ts(),O=es(),n=S(null),l=S(null),c=Z(()=>j.params.id);ss(async()=>{await Q()});const Q=async()=>{try{const{data:e,error:t}=await y.from("poems").select("*").eq("id",c.value).single();if(t){console.error("加载诗词失败:",t);const i=L();n.value=i.find(v=>v.id===c.value)||i[0]}else n.value=e;l.value=R(c.value),await K()}catch(e){console.error("加载诗词数据异常:",e);const t=L();n.value=t.find(i=>i.id===c.value)||t[0],l.value=R(c.value)}},U=e=>({easy:"success",medium:"warning",hard:"danger"})[e]||"info",W=e=>({easy:"简单",medium:"中等",hard:"困难"})[e]||"未知",G=e=>{var i;const t=((i=l.value)==null?void 0:i.word_analysis)||[];return t[e]?`${t[e].character}：${t[e].meaning}`:"暂无详细解析"},H=()=>{O.push(`/chat?poem=${c.value}`)},J=async()=>{var e;try{const{error:t}=await y.from("user_analysis").upsert({user_id:(e=(await y.auth.getUser()).data.user)==null?void 0:e.id,poem_id:c.value,analysis_data:l.value,created_at:new Date().toISOString()});if(t)throw t;F.success("分析已保存")}catch(t){console.error("保存分析失败:",t),F.error("保存失败，请重试")}},K=async()=>{var e;try{await y.from("poems").update({views:(((e=n.value)==null?void 0:e.views)||0)+1}).eq("id",c.value)}catch(t){console.error("记录查看失败:",t)}};return(e,t)=>{var k,w,x,A,D,E,I,B,C,T,b,M,P,V,$,z,N;const i=os,v=rs,g=ns;return r(),d("div",cs,[s("div",ds,[s("div",us,[s("div",_s,[s("h1",ms,a((k=n.value)==null?void 0:k.title),1),s("div",vs,[s("span",ps,a((w=n.value)==null?void 0:w.author),1),s("span",ys,a((x=n.value)==null?void 0:x.dynasty),1),_(i,{type:U((A=n.value)==null?void 0:A.difficulty),size:"small"},{default:m(()=>{var o;return[u(a(W((o=n.value)==null?void 0:o.difficulty)),1)]}),_:1},8,["type"])])]),s("div",fs,[_(g,{type:"primary",onClick:H},{default:m(()=>[_(v,null,{default:m(()=>[_(q(ls))]),_:1}),t[0]||(t[0]=u(" 与AI讨论 ",-1))]),_:1}),_(g,{onClick:J},{default:m(()=>[_(v,null,{default:m(()=>[_(q(is))]),_:1}),t[1]||(t[1]=u(" 保存分析 ",-1))]),_:1})])])]),s("div",hs,[s("div",gs,[s("div",ks,[s("div",ws,[t[2]||(t[2]=s("h3",{class:"section-title"},"诗词原文",-1)),s("div",xs,[(r(!0),d(f,null,h((D=n.value)==null?void 0:D.content,(o,p)=>(r(),d("p",{key:p,class:"poem-line"},a(o),1))),128))])]),s("div",As,[t[3]||(t[3]=s("h3",{class:"section-title"},"逐句解析",-1)),s("div",Ds,[(r(!0),d(f,null,h((E=n.value)==null?void 0:E.content,(o,p)=>(r(),d("div",{key:p,class:"line-item"},[s("div",Es,a(o),1),s("div",Is,a(G(p)),1)]))),128))])])]),s("div",Bs,[s("div",Cs,[t[4]||(t[4]=s("h3",{class:"section-title"},"整体分析",-1)),s("div",Ts,[s("p",null,a((I=l.value)==null?void 0:I.overall_analysis),1)])]),s("div",bs,[t[7]||(t[7]=s("h3",{class:"section-title"},"意象分析",-1)),s("div",Ms,[(r(!0),d(f,null,h((B=l.value)==null?void 0:B.imagery_analysis,o=>(r(),d("div",{key:o.name,class:"imagery-item"},[s("h4",null,a(o.name),1),s("p",null,[t[5]||(t[5]=s("strong",null,"描述：",-1)),u(a(o.description),1)]),s("p",null,[t[6]||(t[6]=s("strong",null,"象征意义：",-1)),u(a(o.symbolism),1)])]))),128))])]),s("div",Ps,[t[11]||(t[11]=s("h3",{class:"section-title"},"作者信息",-1)),s("div",Vs,[s("h4",null,a((T=(C=l.value)==null?void 0:C.author_info)==null?void 0:T.name),1),s("p",null,[t[8]||(t[8]=s("strong",null,"朝代：",-1)),u(a((M=(b=l.value)==null?void 0:b.author_info)==null?void 0:M.dynasty),1)]),s("p",null,[t[9]||(t[9]=s("strong",null,"简介：",-1)),u(a((V=(P=l.value)==null?void 0:P.author_info)==null?void 0:V.biography),1)]),s("div",$s,[t[10]||(t[10]=s("strong",null,"代表作品：",-1)),(r(!0),d(f,null,h((z=($=l.value)==null?void 0:$.author_info)==null?void 0:z.works,o=>(r(),as(i,{key:o,size:"small",style:{margin:"2px 4px"}},{default:m(()=>[u(a(o),1)]),_:2},1024))),128))])])]),s("div",zs,[t[12]||(t[12]=s("h3",{class:"section-title"},"历史背景",-1)),s("div",Ns,[s("p",null,a((N=l.value)==null?void 0:N.historical_context),1)])])])])])])}}});const Us=X(Ss,[["__scopeId","data-v-25431d2f"]]);export{Us as default};
