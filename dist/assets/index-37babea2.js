import{by as Q,r as b,c as N,q as j,a4 as H,y as X,O as M,P as n,C as P,E as y,W as o,a2 as Y,T as v,bz as ee,z as te,$ as pe,aX as re,D as z,u as A,U as K,S as x,bA as me,bB as fe,bv as _e,bC as ge}from"./vendor-0fc5911b.js";import{E as he,a as k,b as ve,c as we,d as ae,e as ye,f as be,g as oe,h as Ee,i as Ae,j as Ie,r as Ce,u as G,s as Z,k as Ve,l as Se,n as Pe,m as ke,o as Ue,p as Oe,q as Le,t as Te,v as Me,w as Re,x as De}from"./element-plus-7b99588a.js";import{a as xe,_ as V}from"./supabase-043902eb.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(i){if(i.ep)return;i.ep=!0;const d=r(i);fetch(i.href,d)}})();const se="https://rnvpihtnbtltaulxsunc.supabase.co",ze="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJudnBpaHRuYnRsdGF1bHhzdW5jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTE0OTcsImV4cCI6MjA3NjA4NzQ5N30.URaYNJGKCMz1Lkfnhf7c0f8XR0Ip1t3aYIy41pAo08k",p=xe(se,ze,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}});se.includes("demo.supabase.co")&&console.warn("⚠️ 使用演示Supabase配置，请配置真实环境变量");const Ne=Object.freeze(Object.defineProperty({__proto__:null,supabase:p},Symbol.toStringTag,{value:"Module"})),qe={async sendMessage(s,a){var l,i,d;const r="https://anranzhou.app.n8n.cloud/webhook/ai-chat";try{const c=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,conversationId:a||"default",timestamp:new Date().toISOString()})});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const g=await c.json();return g.response||((d=(i=(l=g.choices)==null?void 0:l[0])==null?void 0:i.message)==null?void 0:d.content)||"抱歉，我暂时无法回答这个问题。"}catch(c){throw console.error("调用 n8n AI 助手失败:",c),new Error("AI 服务暂时不可用，请稍后重试")}},async analyzePoem(s,a="overall"){const r=this.buildPoemAnalysisPrompt(s,a);return this.sendMessage(r)},buildPoemAnalysisPrompt(s,a){const r={word:"字词解析",imagery:"意象分析",overall:"整体赏析",author:"作者背景",context:"创作背景"};return`请对以下诗词进行${r[a]}：

${s}

请提供专业的${r[a]}，包括：
1. 关键词语的解释和用法
2. 修辞手法和艺术特色
3. 情感表达和意境营造
4. 历史背景和文化内涵

请用中文回答，分析要详细专业。`},async getLearningSuggestions(s,a){const r=`根据用户的学习水平（${s}）和兴趣领域（${a.join(", ")}），提供个性化的诗词学习建议和学习路径规划。`;return this.sendMessage(r)}},F={async getCurrentUser(){const{data:{user:s}}=await p.auth.getUser();if(!s)return null;const{data:a,error:r}=await p.from("profiles").select("*").eq("id",s.id).single();if(r)throw r;return a},async upsertUser(s){const{data:{user:a}}=await p.auth.getUser();if(!a)throw new Error("用户未登录");const{data:r,error:l}=await p.from("profiles").upsert({id:a.id,...s,updated_at:new Date().toISOString()}).select().single();if(l)throw l;return r},async updateLearningProgress(s){const{data:{user:a}}=await p.auth.getUser();if(!a)throw new Error("用户未登录");const{data:r,error:l}=await p.from("profiles").update({learning_progress:s,updated_at:new Date().toISOString()}).eq("id",a.id).select().single();if(l)throw l;return r}},T={async getConversations(){const{data:{user:s}}=await p.auth.getUser();if(!s)throw new Error("用户未登录");const{data:a,error:r}=await p.from("ai_conversations").select("*").eq("user_id",s.id).order("updated_at",{ascending:!1});if(r)throw r;return a||[]},async createConversation(s){const{data:{user:a}}=await p.auth.getUser();if(!a)throw new Error("用户未登录");const{data:r,error:l}=await p.from("ai_conversations").insert({user_id:a.id,poem_id:s||null,title:"新对话"}).select().single();if(l)throw l;return r},async getMessages(s){const{data:a,error:r}=await p.from("ai_messages").select("*").eq("conversation_id",s).order("created_at",{ascending:!0});if(r)throw r;return a||[]},async sendMessage(s,a,r="user"){const{data:l,error:i}=await p.from("ai_messages").insert({conversation_id:s,role:"user",content:a}).select().single();if(i)throw i;if(r==="user")try{const d=await qe.sendMessage(a,s),{data:c,error:g}=await p.from("ai_messages").insert({conversation_id:s,role:"assistant",content:d}).select().single();if(g)throw g;return await p.from("ai_conversations").update({updated_at:new Date().toISOString()}).eq("id",s),c}catch(d){console.error("AI 助手调用失败:",d);const{data:c,error:g}=await p.from("ai_messages").insert({conversation_id:s,role:"assistant",content:"抱歉，AI 助手暂时无法响应，请稍后重试。"}).select().single();if(g)throw g;return c}return await p.from("ai_conversations").update({updated_at:new Date().toISOString()}).eq("id",s),l}},$e=Q("user",()=>{const s=b(null),a=b(!1),r=b(null),l=N(()=>s.value!==null),i=N(()=>{var e;return((e=s.value)==null?void 0:e.role)==="teacher"}),d=async()=>{a.value=!0,r.value=null;try{const e=await F.getCurrentUser();return s.value=e,e}catch(e){return r.value=e instanceof Error?e.message:"加载用户信息失败",console.error("加载用户信息失败:",e),null}finally{a.value=!1}},c=async e=>{a.value=!0,r.value=null;try{const t=await F.upsertUser(e);return s.value=t,t}catch(t){throw r.value=t instanceof Error?t.message:"保存用户信息失败",console.error("保存用户信息失败:",t),t}finally{a.value=!1}},g=()=>{s.value=null,r.value=null};return{user:s,isLoading:a,error:r,isAuthenticated:l,isTeacher:i,loadUser:d,upsertUser:c,clearUser:g,updateLearningProgress:async e=>{if(s.value)try{await F.updateLearningProgress(e),s.value.learningProgress=e}catch(t){throw r.value=t instanceof Error?t.message:"更新学习进度失败",console.error("更新学习进度失败:",t),t}},setupAuthListener:()=>{p.auth.onAuthStateChange(async(e,t)=>{e==="SIGNED_IN"&&(t!=null&&t.user)?await d():e==="SIGNED_OUT"&&g()})}}}),Ge=Q("ai",()=>{const s=b([]),a=b(!1),r=b(void 0),l=b(null),i=N(()=>s.value.find(e=>e.id===r.value)),d=async()=>{a.value=!0,l.value=null;try{const e=await T.getConversations();return s.value=e,e}catch(e){return l.value=e instanceof Error?e.message:"加载对话列表失败",console.error("加载对话列表失败:",e),[]}finally{a.value=!1}},c=async(e,t)=>{r.value||await g(t),a.value=!0,l.value=null;try{await T.sendMessage(r.value,e,"user");const m=`这是AI对"${e}"的响应。基于诗词解析功能，我可以为您提供：

1. 字词解析和注释
2. 意象分析和意境解读
3. 作者生平和创作背景
4. 艺术特色和情感表达

请告诉我您想了解的具体内容。`;await T.sendMessage(r.value,m,"assistant");const E={id:Date.now().toString(),content:m,timestamp:new Date,poemId:t||null};return await f(r.value),E}catch(m){throw l.value=m instanceof Error?m.message:"发送消息失败",console.error("发送消息失败:",m),m}finally{a.value=!1}},g=async e=>{a.value=!0,l.value=null;try{const t=await T.createConversation(e);return s.value.unshift(t),r.value=t.id,await f(t.id),t.id}catch(t){throw l.value=t instanceof Error?t.message:"创建对话失败",console.error("创建对话失败:",t),t}finally{a.value=!1}},f=async e=>{try{const t=await T.getMessages(e),m=s.value.findIndex(E=>E.id===e);m!==-1&&(s.value[m].messages=t.map(E=>({id:E.id,role:E.role,content:E.content,timestamp:new Date(E.created_at)})))}catch(t){console.error("加载对话消息失败:",t)}};return{conversations:s,isLoading:a,currentConversationId:r,currentConversation:i,error:l,loadConversations:d,sendMessage:c,createConversation:g,setCurrentConversation:e=>{r.value=e,f(e)},loadConversationMessages:f}});function Fe(){const s=$e(),a=Ge(),r=N(()=>s.isAuthenticated&&!s.isLoading),l=async()=>{try{return s.setupAuthListener(),await s.loadUser()?(await a.loadConversations(),console.log("应用初始化成功，用户已登录")):console.log("应用初始化成功，用户未登录"),!0}catch(f){return console.error("应用初始化失败:",f),!1}},i=()=>{s.clearUser(),a.conversations=[],a.currentConversationId=void 0};return{userStore:s,aiStore:a,isAppReady:r,initializeApp:l,resetApp:i,login:async(f,h)=>{try{const{data:e,error:t}=await p.auth.signInWithPassword({email:f,password:h});if(t)throw t;return e}catch(e){throw console.error("登录失败:",e),e}},register:async(f,h,e)=>{try{const{data:t,error:m}=await p.auth.signUp({email:f,password:h,options:{data:{username:e}}});if(m)throw m;return t}catch(t){throw console.error("注册失败:",t),t}},logout:async()=>{try{const{error:f}=await p.auth.signOut();if(f)throw f;i()}catch(f){throw console.error("登出失败:",f),f}}}}const je={class:"auth-modal-content"},Be={class:"auth-divider"},Je={class:"social-auth"},We=j({__name:"AuthModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","auth-success"],setup(s,{emit:a}){const r=s,l=a,i=b(!1),d=b("login"),c=b(!1),g=b(),f=b(),h=H({email:"",password:""}),e=H({username:"",email:"",password:"",confirmPassword:"",agreeTerms:!1}),t={email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},E={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(_,u,C)=>{u===""?C(new Error("请确认密码")):u!==e.password?C(new Error("两次输入密码不一致")):C()},trigger:"blur"}]};X(()=>r.modelValue,_=>{i.value=_}),X(i,_=>{l("update:modelValue",_),_||I()});const $=()=>{i.value=!1},I=()=>{h.email="",h.password="",e.username="",e.email="",e.password="",e.confirmPassword="",e.agreeTerms=!1},U=async()=>{if(g.value)try{await g.value.validate(),c.value=!0;const{data:_,error:u}=await p.auth.signInWithPassword({email:h.email,password:h.password});if(u)throw u;_.user&&(k.success("登录成功"),l("auth-success"),i.value=!1)}catch(_){console.error("登录失败:",_),k.error(_.message||"登录失败，请检查邮箱和密码")}finally{c.value=!1}},O=async()=>{if(f.value)try{if(await f.value.validate(),!e.agreeTerms){k.warning("请同意服务条款和隐私政策");return}c.value=!0;const{data:_,error:u}=await p.auth.signUp({email:e.email,password:e.password,options:{data:{username:e.username}}});if(u)throw u;_.user&&(k.success("注册成功！请检查您的邮箱验证账户"),l("auth-success"),i.value=!1)}catch(_){console.error("注册失败:",_),k.error(_.message||"注册失败，请重试")}finally{c.value=!1}},L=async()=>{try{const{error:_}=await p.auth.signInWithOAuth({provider:"github",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(_)throw _}catch(_){console.error("GitHub登录失败:",_),k.error("GitHub登录失败")}},R=async()=>{try{const{error:_}=await p.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(_)throw _}catch(_){console.error("Google登录失败:",_),k.error("Google登录失败")}};return(_,u)=>{const C=ve,S=we,D=ae,B=ye,ie=be,J=oe,W=Ee,ue=Ae,de=Ie,ce=he;return P(),M(ce,{modelValue:i.value,"onUpdate:modelValue":u[8]||(u[8]=w=>i.value=w),title:"用户认证",width:"400px","before-close":$,"align-center":""},{default:n(()=>[y("div",je,[o(de,{modelValue:d.value,"onUpdate:modelValue":u[7]||(u[7]=w=>d.value=w),class:"auth-tabs"},{default:n(()=>[o(W,{label:"登录",name:"login"},{default:n(()=>[o(B,{model:h,rules:t,ref_key:"loginFormRef",ref:g,class:"auth-form",onSubmit:Y(U,["prevent"])},{default:n(()=>[o(S,{prop:"email"},{default:n(()=>[o(C,{modelValue:h.email,"onUpdate:modelValue":u[0]||(u[0]=w=>h.email=w),placeholder:"请输入邮箱",size:"large","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),o(S,{prop:"password"},{default:n(()=>[o(C,{modelValue:h.password,"onUpdate:modelValue":u[1]||(u[1]=w=>h.password=w),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(S,null,{default:n(()=>[o(D,{type:"primary",size:"large",loading:c.value,onClick:U,class:"auth-button"},{default:n(()=>[...u[9]||(u[9]=[v(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),y("div",Be,[o(ie,null,{default:n(()=>[...u[10]||(u[10]=[v("或",-1)])]),_:1})]),y("div",Je,[o(D,{class:"social-button github",onClick:L},{default:n(()=>[o(J,null,{default:n(()=>[...u[11]||(u[11]=[y("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[y("path",{fill:"currentColor",d:"M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9 23.5 23.2 38.1 55.4 38.1 91v112.5c0 8.1 0 16.3 1.9 24.1 0 0 0 0 0 0C831.1 885 956.4 718.9 956.4 523.5 956.4 276.4 756.1 76.3 511.6 76.3z"})],-1)])]),_:1}),u[12]||(u[12]=v(" GitHub登录 ",-1))]),_:1}),o(D,{class:"social-button google",onClick:R},{default:n(()=>[o(J,null,{default:n(()=>[...u[13]||(u[13]=[y("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[y("path",{fill:"currentColor",d:"M881 442.4H519.7v148.5h206.4c-8.9 48-35.9 88.6-76.6 115.8-34.4 23-78.3 36.6-129.9 36.6-99.9 0-184.4-67.5-214.6-158.2-7.6-23-12-47.6-12-72.9s4.4-49.9 12-72.9c30.3-90.6 114.8-158.1 214.7-158.1 56.3 0 106.8 19.4 146.6 57.4l110-110.1C757.6 109.4 649.4 60 522.2 60 294.1 60 109.4 244.7 109.4 472.8c0 228.1 184.7 412.8 412.8 412.8 228.1 0 412.8-184.7 412.8-412.8 0-11.4-.5-22.7-1.5-34z"})],-1)])]),_:1}),u[14]||(u[14]=v(" Google登录 ",-1))]),_:1})])]),_:1}),o(W,{label:"注册",name:"register"},{default:n(()=>[o(B,{model:e,rules:E,ref_key:"registerFormRef",ref:f,class:"auth-form",onSubmit:Y(O,["prevent"])},{default:n(()=>[o(S,{prop:"username"},{default:n(()=>[o(C,{modelValue:e.username,"onUpdate:modelValue":u[2]||(u[2]=w=>e.username=w),placeholder:"请输入用户名",size:"large","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(S,{prop:"email"},{default:n(()=>[o(C,{modelValue:e.email,"onUpdate:modelValue":u[3]||(u[3]=w=>e.email=w),placeholder:"请输入邮箱",size:"large","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),o(S,{prop:"password"},{default:n(()=>[o(C,{modelValue:e.password,"onUpdate:modelValue":u[4]||(u[4]=w=>e.password=w),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(S,{prop:"confirmPassword"},{default:n(()=>[o(C,{modelValue:e.confirmPassword,"onUpdate:modelValue":u[5]||(u[5]=w=>e.confirmPassword=w),type:"password",placeholder:"请确认密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(S,null,{default:n(()=>[o(ue,{modelValue:e.agreeTerms,"onUpdate:modelValue":u[6]||(u[6]=w=>e.agreeTerms=w)},{default:n(()=>[...u[15]||(u[15]=[v(" 我已阅读并同意服务条款和隐私政策 ",-1)])]),_:1},8,["modelValue"])]),_:1}),o(S,null,{default:n(()=>[o(D,{type:"primary",size:"large",loading:c.value,disabled:!e.agreeTerms,onClick:O,class:"auth-button"},{default:n(()=>[...u[16]||(u[16]=[v(" 注册 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}});const ne=(s,a)=>{const r=s.__vccOpts||s;for(const[l,i]of a)r[l]=i;return r},He=ne(We,[["__scopeId","data-v-6e020a66"]]),Xe={class:"navbar"},Ye={class:"navbar-container"},Ke={class:"navbar-brand"},Ze={class:"brand-logo"},Qe={key:0,class:"desktop-user-menu"},et={class:"user-dropdown"},tt={class:"user-name"},rt={key:1,class:"auth-buttons"},at={class:"mobile-menu"},ot=j({__name:"Navbar",setup(s){const a=ee();b("");const r=b(null);te(async()=>{await l(),i()}),pe(()=>{const{data:{subscription:e}}=p.auth.onAuthStateChange(()=>{});e==null||e.unsubscribe()});const l=async()=>{try{const{data:{user:e}}=await p.auth.getUser();if(e){const{data:t}=await p.from("profiles").select("*").eq("id",e.id).single();r.value={...e,...t}}else r.value=null}catch(e){console.error("检查认证状态失败:",e),r.value=null}},i=()=>{p.auth.onAuthStateChange(async(e,t)=>{console.log("认证状态变化:",e),e==="SIGNED_IN"&&(t!=null&&t.user)?await l():e==="SIGNED_OUT"&&(r.value=null)})},d=e=>{switch(e){case"profile":a.push("/profile");break;case"settings":a.push("/settings");break;case"logout":h();break}},c=e=>{switch(e){case"home":a.push("/");break;case"poems":a.push("/poems");break;case"chat":a.push("/chat");break;case"profile":a.push("/profile");break;case"settings":a.push("/settings");break;case"login":a.push("/login");break;case"register":a.push("/register");break;case"logout":h();break}},g=()=>{a.push("/login")},f=()=>{a.push("/register")},h=async()=>{try{const{error:e}=await p.auth.signOut();if(e)throw e;r.value=null,k.success("退出登录成功"),a.push("/")}catch(e){console.error("退出登录失败:",e),k.error("退出登录失败")}};return(e,t)=>{const m=oe,E=re("router-link"),$=Le,I=Te,U=Me,O=Re,L=ae;return P(),z("div",Xe,[y("div",Ye,[y("div",Ke,[o(E,{to:"/",class:"brand-link"},{default:n(()=>[y("div",Ze,[o(m,{size:"24",color:"#409eff"},{default:n(()=>[o(A(Ce))]),_:1})]),t[0]||(t[0]=y("span",{class:"brand-text"},"诗词分析平台",-1))]),_:1})]),r.value?(P(),z("div",Qe,[o(O,{onCommand:d},{dropdown:n(()=>[o(U,null,{default:n(()=>[o(I,{command:"profile"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(G))]),_:1}),t[1]||(t[1]=v(" 个人中心 ",-1))]),_:1}),o(I,{divided:"",command:"logout"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Z))]),_:1}),t[2]||(t[2]=v(" 退出登录 ",-1))]),_:1})]),_:1})]),default:n(()=>[y("span",et,[o($,{size:32,src:r.value.avatar_url,class:"user-avatar"},{default:n(()=>{var R;return[v(K(((R=r.value.username)==null?void 0:R.charAt(0))||"U"),1)]}),_:1},8,["src"]),y("span",tt,K(r.value.username||"用户"),1),o(m,null,{default:n(()=>[o(A(Ve))]),_:1})])]),_:1})])):(P(),z("div",rt,[o(L,{type:"primary",text:"",onClick:g},{default:n(()=>[...t[3]||(t[3]=[v("登录",-1)])]),_:1}),o(L,{type:"primary",onClick:f},{default:n(()=>[...t[4]||(t[4]=[v("注册",-1)])]),_:1})])),y("div",at,[o(O,{onCommand:c},{dropdown:n(()=>[o(U,null,{default:n(()=>[o(I,{command:"home"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Se))]),_:1}),t[5]||(t[5]=v(" 首页 ",-1))]),_:1}),o(I,{command:"poems"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Pe))]),_:1}),t[6]||(t[6]=v(" 诗词库 ",-1))]),_:1}),o(I,{command:"chat"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(ke))]),_:1}),t[7]||(t[7]=v(" AI助手 ",-1))]),_:1}),r.value?(P(),M(I,{key:0,command:"profile"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(G))]),_:1}),t[8]||(t[8]=v(" 个人中心 ",-1))]),_:1})):x("",!0),r.value?x("",!0):(P(),M(I,{key:1,divided:"",command:"login"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(G))]),_:1}),t[9]||(t[9]=v(" 登录 ",-1))]),_:1})),r.value?x("",!0):(P(),M(I,{key:2,command:"register"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Ue))]),_:1}),t[10]||(t[10]=v(" 注册 ",-1))]),_:1})),r.value?(P(),M(I,{key:3,command:"logout"},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Z))]),_:1}),t[11]||(t[11]=v(" 退出登录 ",-1))]),_:1})):x("",!0)]),_:1})]),default:n(()=>[o(L,{text:""},{default:n(()=>[o(m,null,{default:n(()=>[o(A(Oe))]),_:1})]),_:1})]),_:1})])])])}}});const st=ne(ot,[["__scopeId","data-v-75b93bc7"]]),nt={id:"app"},lt={class:"app-main"},it=j({__name:"App",setup(s){const a=ee(),r=Fe(),l=b(!1),i=()=>{l.value=!1,a.go(0)};return te(async()=>{await r.initializeApp();const d=a.currentRoute.value;["/profile","/chat"].includes(d.path)&&!r.userStore.isAuthenticated&&(l.value=!0)}),(d,c)=>{const g=re("router-view");return P(),z("div",nt,[o(st),y("main",lt,[o(g),o(He,{modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=f=>l.value=f),onAuthSuccess:i},null,8,["modelValue"])])])}}});const ut=[{path:"/",name:"Dashboard",component:()=>V(()=>import("./Dashboard-89939f77.js"),["assets/Dashboard-89939f77.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/Dashboard-3f8082f8.css"])},{path:"/poems",name:"Poems",component:()=>V(()=>import("./Poems-e2dbe0f6.js"),["assets/Poems-e2dbe0f6.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/mockData-3b1561c6.js","assets/Poems-e13b4da8.css"])},{path:"/analysis/:id",name:"Analysis",component:()=>V(()=>import("./Analysis-970fc232.js"),["assets/Analysis-970fc232.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/mockData-3b1561c6.js","assets/Analysis-e02ff6bd.css"]),props:!0},{path:"/poet-profile",name:"PoetProfile",component:()=>V(()=>import("./PoetProfile-f90bf0d4.js"),["assets/PoetProfile-f90bf0d4.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/PoetProfile-148952b0.css"])},{path:"/profile",name:"Profile",component:()=>V(()=>import("./Profile-6f63930d.js"),["assets/Profile-6f63930d.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/mockData-3b1561c6.js","assets/Profile-f15b0f10.css"])},{path:"/login",name:"Login",component:()=>V(()=>import("./Login-f831ad25.js"),["assets/Login-f831ad25.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/Login-b911c56b.css"])},{path:"/register",name:"Register",component:()=>V(()=>import("./Register-022ed530.js"),["assets/Register-022ed530.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/Register-c073e8f0.css"])},{path:"/settings",name:"Settings",component:()=>V(()=>import("./Settings-732a2288.js"),["assets/Settings-732a2288.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/Settings-cf7181f4.css"])},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>V(()=>import("./NotFound-7c8305de.js"),["assets/NotFound-7c8305de.js","assets/element-plus-7b99588a.js","assets/vendor-0fc5911b.js","assets/supabase-043902eb.js","assets/element-plus-ae7eea91.css","assets/NotFound-16f288ea.css"])}],le=me({history:fe(),routes:ut});le.beforeEach(async(s,a,r)=>{try{const{supabase:l}=await V(()=>Promise.resolve().then(()=>Ne),void 0),{data:{user:i}}=await l.auth.getUser();["/profile"].includes(s.path)&&!i?r("/login"):r()}catch(l){console.error("路由守卫错误:",l),r()}});const q=_e(it),dt=ge();q.use(dt);q.use(le);q.use(De);q.mount("#app");console.log("诗韵星应用启动成功");export{ne as _,p as s,$e as u};
