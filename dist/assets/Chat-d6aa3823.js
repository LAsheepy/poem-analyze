import{d as E,g as _,G as F,h as G,L as b,c,b as t,a as l,w as u,F as T,n as z,p as H,q as Q,M as U,K as $,P as j,r as m,o as d,e as V,Q as J,m as y,R as B,t as g,S as W,_ as X}from"./main-f1684cbb.js";import{b as w}from"./mockData-bed7268a.js";const Y={class:"chat-page"},Z={class:"chat-container"},ee={class:"conversation-sidebar"},te={class:"sidebar-header"},se={class:"conversation-list"},ae=["onClick"],oe={class:"conv-title"},ne={class:"conv-time"},le={class:"chat-main"},ie={class:"message-avatar"},re={key:0},ce={key:1},ue={class:"message-content"},de={class:"message-text"},ve={class:"message-time"},_e={class:"chat-input-area"},pe={class:"input-container"},me={class:"input-actions"},ge=E({__name:"Chat",setup(fe){const L=U(),p=_(),i=_(""),f=_(!1),n=_([]),o=_(null),C=F(()=>L.query.poem);G(async()=>{await N(),C.value&&R(C.value)});const N=async()=>{try{const{data:s,error:e}=await b.from("conversations").select("*").order("created_at",{ascending:!1});e?(console.error("加载对话失败:",e),n.value=w()):s&&s.length>0?n.value=s:n.value=w(),n.value.length>0&&(o.value=n.value[0])}catch(s){console.error("加载对话异常:",s),n.value=w(),n.value.length>0&&(o.value=n.value[0])}},k=()=>{const s={id:Date.now().toString(),title:"新对话",created_at:new Date().toISOString(),messages:[]};n.value.unshift(s),o.value=s},K=s=>{o.value=s},R=s=>{i.value="请帮我分析一下这首诗词"},M=async()=>{if(!i.value.trim())return;o.value||k();const s={id:Date.now().toString(),role:"user",content:i.value,created_at:new Date().toISOString()};o.value.messages.push(s),o.value.messages.length===1&&(o.value.title=i.value.slice(0,20)+"..."),I();const e=i.value;i.value="",f.value=!0;try{await new Promise(h=>setTimeout(h,1e3));const r=await A(e),v={id:(Date.now()+1).toString(),role:"assistant",content:r,created_at:new Date().toISOString()};o.value.messages.push(v),I(),await O(o.value)}catch(r){console.error("发送消息失败:",r),$.error("发送失败，请重试")}finally{f.value=!1}},A=async s=>{const e=["这首诗词表达了深切的思乡之情，通过月光意象营造出宁静而忧郁的氛围。","从文学角度看，这首诗运用了对比手法，将自然景物与内心情感巧妙结合。","这首诗的意境深远，语言简练，体现了作者高超的艺术造诣。","从历史背景来看，这首诗反映了当时文人的普遍情感和时代特征。","这首诗的韵律优美，结构严谨，是古典诗词的典范之作。"];return e[Math.floor(Math.random()*e.length)]},O=async s=>{try{const{error:e}=await b.from("conversations").upsert(s);e&&console.error("保存对话失败:",e)}catch(e){console.error("保存对话异常:",e)}},P=()=>{i.value=""},I=()=>{j(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},S=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(s,e)=>{var x;const r=m("el-icon"),v=m("el-button"),h=m("el-avatar"),q=m("el-input");return d(),c("div",Y,[e[6]||(e[6]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"AI诗词助手"),t("p",{class:"page-subtitle"},"与AI讨论诗词，获得个性化解析")],-1)),t("div",Z,[t("div",ee,[t("div",te,[e[2]||(e[2]=t("h3",null,"对话历史",-1)),l(v,{type:"primary",size:"small",onClick:k},{default:u(()=>[l(r,null,{default:u(()=>[l(V(J))]),_:1}),e[1]||(e[1]=y(" 新建对话 ",-1))]),_:1})]),t("div",se,[(d(!0),c(T,null,z(n.value,a=>{var D;return d(),c("div",{key:a.id,class:B(["conversation-item",{active:((D=o.value)==null?void 0:D.id)===a.id}]),onClick:he=>K(a)},[t("div",oe,g(a.title),1),t("div",ne,g(S(a.created_at)),1)],10,ae)}),128))])]),t("div",le,[t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:p},[(d(!0),c(T,null,z((x=o.value)==null?void 0:x.messages,a=>(d(),c("div",{key:a.id,class:B(["message",a.role])},[t("div",ie,[l(h,{size:32},{default:u(()=>[a.role==="user"?(d(),c("span",re,"👤")):(d(),c("span",ce,"🤖"))]),_:2},1024)]),t("div",ue,[t("div",de,g(a.content),1),t("div",ve,g(S(a.created_at)),1)])],2))),128))],512),t("div",_e,[t("div",pe,[l(q,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),type:"textarea",rows:3,placeholder:"输入您的问题或想讨论的诗词...",onKeydown:H(Q(M,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),t("div",me,[l(v,{type:"primary",onClick:M,loading:f.value},{default:u(()=>[l(r,null,{default:u(()=>[...e[3]||(e[3]=[t("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[t("path",{fill:"currentColor",d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2-3.7 0.9-6.9 3-9 6.1-2.1 3.1-3.1 6.8-2.7 10.5l86.3 352.8-86.3 352.8c-0.4 3.7 0.6 7.4 2.7 10.5 2.1 3.1 5.3 5.2 9 6.1 0.8 0.2 1.6 0.3 2.4 0.3 2.9 0 5.7-0.9 8.1-2.6l836.5-419.4c3.1-1.6 5.2-4.5 5.9-7.8 0.7-3.3-0.1-6.7-2.1-9.3-1.9-2.6-4.9-4.2-8.1-4.2zM170.8 834.3l63.3-258.9 258.9-63.3-258.9-63.3-63.3-258.9 580.5 290.3-580.5 290.3z"})],-1)])]),_:1}),e[4]||(e[4]=y(" 发送 ",-1))]),_:1},8,["loading"]),l(v,{onClick:P},{default:u(()=>[l(r,null,{default:u(()=>[l(V(W))]),_:1}),e[5]||(e[5]=y(" 清空 ",-1))]),_:1})])])])])])])}}});const Ce=X(ge,[["__scopeId","data-v-63fe4ded"]]);export{Ce as default};
