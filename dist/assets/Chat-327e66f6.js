import{s as A,_ as P}from"./index-a3a8f004.js";import{j as U,r as v,c as $,e as j,l as c,t as s,J as r,C as u,F as x,$ as D,a6 as q,E as H,ai as J,n as Q,k as _,u as T,U as f}from"./vendor-3a970c2f.js";import{Q as W,T as G,R as X,as as Y,p as b,a1 as p,at as Z,W as ee,a8 as te}from"./element-plus-f60a088f.js";import{b as y}from"./mockData-70ed22ed.js";import"./supabase-43a56c42.js";const se={class:"chat-page"},ae={class:"main-content"},oe={class:"chat-container"},ne={class:"conversation-sidebar"},ie={class:"sidebar-header"},le={class:"conversation-list"},re=["onClick"],de={class:"conv-title"},ce={class:"conv-time"},ue={class:"chat-main"},_e={class:"message-avatar"},ve={key:0},me={key:1},pe={class:"message-content"},ge={class:"message-text"},he={class:"message-time"},fe={class:"chat-input-area"},ye={class:"input-container"},we={class:"input-actions"},Ce=U({__name:"Chat",setup(Ie){const z=J(),m=v(),d=v(""),g=v(!1),l=v([]),o=v(null),w=$(()=>z.query.poem);j(async()=>{await E(),w.value&&N(w.value)});const E=async()=>{try{const{data:e,error:t}=await A.from("ai_conversations").select("*").order("created_at",{ascending:!1});t?(console.error("åŠ è½½å¯¹è¯å¤±è´¥:",t),l.value=y()):e&&e.length>0?l.value=e.map(a=>({id:a.id,userId:a.user_id,poemId:a.poem_id,title:a.title,messages:a.messages||[],createdAt:a.created_at,updatedAt:a.updated_at})):l.value=y(),l.value.length>0&&(o.value=l.value[0])}catch(e){console.error("åŠ è½½å¯¹è¯å¼‚å¸¸:",e),l.value=y(),l.value.length>0&&(o.value=l.value[0])}},C=()=>{const e={id:Date.now().toString(),userId:"",poemId:null,title:"æ–°å¯¹è¯",messages:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};l.value.unshift(e),o.value=e},B=e=>{o.value=e},N=e=>{d.value="è¯·å¸®æˆ‘åˆ†æžä¸€ä¸‹è¿™é¦–è¯—è¯"},I=async()=>{if(!d.value.trim())return;o.value||C();const e={id:Date.now().toString(),conversationId:o.value.id,role:"user",content:d.value,timestamp:new Date};o.value.messages.push(e),o.value.messages.length===1&&(o.value.title=d.value.slice(0,20)+"..."),k();const t=d.value;d.value="",g.value=!0;try{await new Promise(h=>setTimeout(h,1e3));const a=await V(t),i={id:(Date.now()+1).toString(),conversationId:o.value.id,role:"assistant",content:a,timestamp:new Date};o.value.messages.push(i),k(),await L(o.value)}catch(a){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",a),W.error("å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{g.value=!1}},V=async e=>{const t=["è¿™é¦–è¯—è¯è¡¨è¾¾äº†æ·±åˆ‡çš„æ€ä¹¡ä¹‹æƒ…ï¼Œé€šè¿‡æœˆå…‰æ„è±¡è¥é€ å‡ºå®é™è€Œå¿§éƒçš„æ°›å›´ã€‚","ä»Žæ–‡å­¦è§’åº¦çœ‹ï¼Œè¿™é¦–è¯—è¿ç”¨äº†å¯¹æ¯”æ‰‹æ³•ï¼Œå°†è‡ªç„¶æ™¯ç‰©ä¸Žå†…å¿ƒæƒ…æ„Ÿå·§å¦™ç»“åˆã€‚","è¿™é¦–è¯—çš„æ„å¢ƒæ·±è¿œï¼Œè¯­è¨€ç®€ç»ƒï¼Œä½“çŽ°äº†ä½œè€…é«˜è¶…çš„è‰ºæœ¯é€ è¯£ã€‚","ä»ŽåŽ†å²èƒŒæ™¯æ¥çœ‹ï¼Œè¿™é¦–è¯—åæ˜ äº†å½“æ—¶æ–‡äººçš„æ™®éæƒ…æ„Ÿå’Œæ—¶ä»£ç‰¹å¾ã€‚","è¿™é¦–è¯—çš„éŸµå¾‹ä¼˜ç¾Žï¼Œç»“æž„ä¸¥è°¨ï¼Œæ˜¯å¤å…¸è¯—è¯çš„å…¸èŒƒä¹‹ä½œã€‚"];return t[Math.floor(Math.random()*t.length)]},L=async e=>{try{const t={id:e.id,user_id:e.userId,poem_id:e.poemId,title:e.title,messages:e.messages.map(i=>({id:i.id,conversation_id:i.conversationId,role:i.role,content:i.content,created_at:i.timestamp.toISOString()})),created_at:e.createdAt,updated_at:e.updatedAt},{error:a}=await A.from("ai_conversations").upsert(t);a&&console.error("ä¿å­˜å¯¹è¯å¤±è´¥:",a)}catch(t){console.error("ä¿å­˜å¯¹è¯å¼‚å¸¸:",t)}},R=()=>{d.value=""},k=()=>{Q(()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)})},K=e=>new Date(e).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),O=e=>e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return(e,t)=>{var M;const a=ee,i=G,h=te,F=X;return _(),c("div",se,[t[6]||(t[6]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",{class:"page-title"},"AIè¯—è¯åŠ©æ‰‹"),s("p",{class:"page-subtitle"},"ä¸ŽAIè®¨è®ºè¯—è¯ï¼ŒèŽ·å¾—ä¸ªæ€§åŒ–è§£æž")])],-1)),s("div",ae,[s("div",oe,[s("div",ne,[s("div",ie,[t[2]||(t[2]=s("h3",null,"å¯¹è¯åŽ†å²",-1)),r(i,{type:"primary",size:"small",onClick:C},{default:u(()=>[r(a,null,{default:u(()=>[r(T(Y))]),_:1}),t[1]||(t[1]=f(" æ–°å»ºå¯¹è¯ ",-1))]),_:1})]),s("div",le,[(_(!0),c(x,null,D(l.value,n=>{var S;return _(),c("div",{key:n.id,class:b(["conversation-item",{active:((S=o.value)==null?void 0:S.id)===n.id}]),onClick:ke=>B(n)},[s("div",de,p(n.title),1),s("div",ce,p(K(n.createdAt)),1)],10,re)}),128))])])]),s("div",ue,[s("div",{class:"chat-messages",ref_key:"messagesContainer",ref:m},[(_(!0),c(x,null,D((M=o.value)==null?void 0:M.messages,n=>(_(),c("div",{key:n.id,class:b(["message",n.role])},[s("div",_e,[r(h,{size:32},{default:u(()=>[n.role==="user"?(_(),c("span",ve,"ðŸ‘¤")):(_(),c("span",me,"ðŸ¤–"))]),_:2},1024)]),s("div",pe,[s("div",ge,p(n.content),1),s("div",he,p(O(n.timestamp)),1)])],2))),128))],512),s("div",fe,[s("div",ye,[r(F,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),type:"textarea",rows:3,placeholder:"è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–æƒ³è®¨è®ºçš„è¯—è¯...",onKeydown:q(H(I,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),s("div",we,[r(i,{type:"primary",onClick:I,loading:g.value},{default:u(()=>[r(a,null,{default:u(()=>[...t[3]||(t[3]=[s("svg",{viewBox:"0 0 1024 1024",width:"16",height:"16"},[s("path",{fill:"currentColor",d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2-3.7 0.9-6.9 3-9 6.1-2.1 3.1-3.1 6.8-2.7 10.5l86.3 352.8-86.3 352.8c-0.4 3.7 0.6 7.4 2.7 10.5 2.1 3.1 5.3 5.2 9 6.1 0.8 0.2 1.6 0.3 2.4 0.3 2.9 0 5.7-0.9 8.1-2.6l836.5-419.4c3.1-1.6 5.2-4.5 5.9-7.8 0.7-3.3-0.1-6.7-2.1-9.3-1.9-2.6-4.9-4.2-8.1-4.2zM170.8 834.3l63.3-258.9 258.9-63.3-258.9-63.3-63.3-258.9 580.5 290.3-580.5 290.3z"})],-1)])]),_:1}),t[4]||(t[4]=f(" å‘é€ ",-1))]),_:1},8,["loading"]),r(i,{onClick:R},{default:u(()=>[r(a,null,{default:u(()=>[r(T(Z))]),_:1}),t[5]||(t[5]=f(" æ¸…ç©º ",-1))]),_:1})])])])])])])}}});const Te=P(Ce,[["__scopeId","data-v-73a07878"]]);export{Te as default};
