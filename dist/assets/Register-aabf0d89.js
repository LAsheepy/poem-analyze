import{s as w,_ as x}from"./index-dbf40142.js";import{j as y,r as v,L as E,l as P,t as d,E as r,z as a,J as R,D as u,ae as U,a3 as T,k as I}from"./vendor-7b22a6b9.js";import{U as h,Q as n,R as z,S as C,Y as F,T as q}from"./element-plus-ca2ac304.js";import"./supabase-4ef77c04.js";const B={class:"register-page"},M={class:"register-container"},L={class:"register-card"},N={class:"register-footer"},S={class:"login-link"},W=y({__name:"Register",setup(j){const m=U(),g=v(),f=v(!1),s=E({username:"",email:"",password:"",confirmPassword:"",agreeTerms:!1}),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(i,e,o)=>{e===""?o(new Error("请确认密码")):e!==s.password?o(new Error("两次输入密码不一致")):o()},trigger:"blur"}]},_=async()=>{if(g.value)try{if(await g.value.validate(),!s.agreeTerms){n.warning("请同意服务条款和隐私政策");return}f.value=!0;const{data:i,error:e}=await w.auth.signInWithPassword({email:s.email,password:s.password});if(i!=null&&i.user){n.success("登录成功！"),m.push("/");return}const{data:o,error:t}=await w.auth.signUp({email:s.email,password:s.password,options:{data:{username:s.username}}});if(t){if(t.message.includes("User already registered")){n.error("该邮箱已被注册，请直接登录");return}else if(t.message.includes("confirmation email"))throw n.warning("邮箱验证服务暂时不可用，正在尝试直接创建用户..."),new Error("注册服务暂时不可用，请稍后重试或联系管理员配置SMTP服务");throw t}if(o.user)if(o.user.identities&&o.user.identities.length>0){const{data:p,error:c}=await w.auth.signInWithPassword({email:s.email,password:s.password});if(c){n.success("注册成功！请检查您的邮箱完成验证，然后重新登录"),m.push("/login");return}n.success("注册成功！已自动登录"),m.push("/")}else n.success("注册成功！请检查您的邮箱完成验证"),m.push("/login")}catch(i){console.error("注册失败:",i),n.error(i.message||"注册失败，请重试")}finally{f.value=!1}};return(i,e)=>{const o=z,t=C,p=T("router-link"),c=F,V=q,k=h;return I(),P("div",B,[d("div",M,[d("div",L,[e[12]||(e[12]=d("div",{class:"register-header"},[d("h1",{class:"register-title"},"注册诗词分析平台"),d("p",{class:"register-subtitle"},"开启您的诗词学习之旅")],-1)),r(k,{model:s,rules:b,ref_key:"registerFormRef",ref:g,class:"register-form",onSubmit:R(_,["prevent"])},{default:a(()=>[r(t,{prop:"username"},{default:a(()=>[r(o,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.username=l),placeholder:"请输入用户名",size:"large","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),r(t,{prop:"email"},{default:a(()=>[r(o,{modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=l=>s.email=l),placeholder:"请输入邮箱",size:"large","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),r(t,{prop:"password"},{default:a(()=>[r(o,{modelValue:s.password,"onUpdate:modelValue":e[2]||(e[2]=l=>s.password=l),type:"password",placeholder:"请输入密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),r(t,{prop:"confirmPassword"},{default:a(()=>[r(o,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=l=>s.confirmPassword=l),type:"password",placeholder:"请确认密码",size:"large","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),r(t,null,{default:a(()=>[r(c,{modelValue:s.agreeTerms,"onUpdate:modelValue":e[4]||(e[4]=l=>s.agreeTerms=l)},{default:a(()=>[e[7]||(e[7]=u(" 我已阅读并同意 ",-1)),r(p,{to:"/terms",class:"link"},{default:a(()=>[...e[5]||(e[5]=[u("服务条款",-1)])]),_:1}),e[8]||(e[8]=u(" 和 ",-1)),r(p,{to:"/privacy",class:"link"},{default:a(()=>[...e[6]||(e[6]=[u("隐私政策",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(t,null,{default:a(()=>[r(V,{type:"primary",size:"large",loading:f.value,disabled:!s.agreeTerms,onClick:_,class:"register-button"},{default:a(()=>[...e[9]||(e[9]=[u(" 注册 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"]),d("div",N,[d("p",S,[e[11]||(e[11]=u(" 已有账号？ ",-1)),r(p,{to:"/login",class:"link"},{default:a(()=>[...e[10]||(e[10]=[u("立即登录",-1)])]),_:1})])])])])])}}});const G=x(W,[["__scopeId","data-v-c0096b5b"]]);export{G as default};
