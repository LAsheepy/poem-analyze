var pe=Object.defineProperty;var fe=(v,s,e)=>s in v?pe(v,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[s]=e;var B=(v,s,e)=>(fe(v,typeof s!="symbol"?s+"":s,e),e);import{a as m,b as ne,c as ge,W as oe,e as me,d as ae,E as _e,q as ve,g as re,z as le,X as he,O as ye,Y as we,Z as Ce,_ as ke,$ as Ne}from"./element-plus-21ed9e7d.js";import{q as J,r as N,a4 as be,y as Y,C as h,O as ie,P as o,E as n,W as t,T as C,c as F,z as Se,aX as S,D as w,u as Ie,G,U as q,S as Z,V as ee,ak as te,al as Ue,a2 as $e,I as xe}from"./vendor-0fc5911b.js";import{_ as Q,u as Me}from"./index-044b3288.js";import"./supabase-043902eb.js";class Ae{constructor(){B(this,"baseURL","/api")}async sendMessage(s,e,i){var a;const d=((a=s[s.length-1])==null?void 0:a.content)||"",c=await fetch(`${this.baseURL}/deepseek-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:d,conversationId:e,userId:i})});if(!c.ok){const _=await c.json();throw new Error(_.error||`API请求失败: ${c.statusText}`)}const l=await c.json();return{id:`chatcmpl_${Date.now()}`,object:"chat.completion",created:Math.floor(Date.now()/1e3),model:"deepseek-chat",choices:[{index:0,message:{role:"assistant",content:l.response},finish_reason:"stop"}],usage:{prompt_tokens:0,completion_tokens:0,total_tokens:0}}}async analyzePoem(s,e,i){const d=`你是一个专业的诗词分析AI助手。请对用户提供的诗词进行专业解析：

**解析要求：**
1. 分析诗词的主题思想和情感表达
2. 解析诗词的艺术特色和修辞手法
3. 介绍诗人的创作背景和文学风格
4. 解释诗词中的文化典故和历史背景
5. 提供分层的详细解析（字词→意象→整体意境）

**回答格式：**
- 语言优美，富有文学气息
- 结构清晰，层次分明
- 结合具体诗句进行分析
- 适当引用相关诗词进行对比`,c=e||i?`请分析以下诗词：
${s}

${e?`诗人：${e}`:""}
${i?`背景信息：${i}`:""}`:`请分析以下诗词：${s}`,l=[{role:"system",content:d},{role:"user",content:c}];try{return(await this.sendMessage(l,"poem_analysis")).choices[0].message.content}catch(a){throw console.error("诗词分析失败:",a),new Error("诗词分析服务暂时不可用，请稍后重试")}}async introducePoet(s){const i=[{role:"system",content:`你是一个专业的文学研究AI助手。请详细介绍指定的诗人：

**介绍要求：**
1. 诗人的生平和重要经历
2. 诗人的文学成就和代表作品
3. 诗人的创作风格和艺术特色
4. 诗人在文学史上的地位和影响
5. 相关的历史背景和文化环境

**回答格式：**
- 内容详实，信息准确
- 结构清晰，重点突出
- 语言专业但不失生动
- 适当引用诗人的代表诗句`},{role:"user",content:`请详细介绍诗人：${s}`}];try{return(await this.sendMessage(i,"poet_introduction")).choices[0].message.content}catch(d){throw console.error("诗人介绍失败:",d),new Error("诗人介绍服务暂时不可用，请稍后重试")}}}const H=new Ae;class Ee{constructor(){B(this,"config",{webhookUrl:"",useN8N:!1})}configure(s){this.config={...this.config,...s}}async sendMessage(s,e="default",i){if(!this.config.useN8N||!this.config.webhookUrl)throw new Error("n8n服务未配置或未启用");const d={message:s,conversationId:e,userId:i,timestamp:new Date().toISOString()};try{const c=await fetch(this.config.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify(d)});if(!c.ok)throw new Error(`n8n工作流请求失败: ${c.statusText}`);const l=await c.json();if(!l.response)throw new Error("n8n工作流返回无效的响应格式");return{response:l.response,conversationId:l.conversationId||e,userMessage:l.userMessage||s,timestamp:l.timestamp||new Date().toISOString()}}catch(c){throw console.error("n8n服务调用失败:",c),new Error("n8n工作流暂时不可用，请检查配置或稍后重试")}}async testConnection(){if(!this.config.webhookUrl)return!1;try{const s=await fetch(this.config.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify({message:"测试连接",conversationId:"test",timestamp:new Date().toISOString()})});if(!s.ok)return console.error("n8n连接测试失败:",s.status,s.statusText),!1;const e=await s.json();return!0}catch(s){return console.error("n8n连接测试失败:",s),!1}}getConfig(){return{...this.config}}toggleServiceMode(s){this.config.useN8N=s}}const b=new Ee,Ve={webhookUrl:"https://anranzhou.app.n8n.cloud/webhook/ai-chat",apiKey:{}.VITE_N8N_API_KEY||"",useN8N:!1};b.configure(Ve);class Pe{constructor(){B(this,"config",{useN8N:!1,conversationId:"default"})}configure(s){this.config={...this.config,...s}}async sendMessage(s,e){var c;const i=e||this.config.conversationId,d=((c=s[s.length-1])==null?void 0:c.content)||"";try{if(this.config.useN8N){const l=await b.sendMessage(d,i,this.config.userId);return{id:`n8n_${Date.now()}`,content:l.response,timestamp:Date.now(),service:"n8n"}}else{const l=await H.sendMessage(s,i,this.config.userId);return{id:l.id,content:l.choices[0].message.content,timestamp:l.created*1e3,service:"deepseek"}}}catch(l){throw console.error("聊天服务调用失败:",l),l}}async analyzePoem(s,e,i){if(this.config.useN8N){const d=e||i?`请分析以下诗词：${s}
${e?`诗人：${e}`:""}
${i?`背景：${i}`:""}`:`请分析以下诗词：${s}`;return(await this.sendMessage([{role:"user",content:d}],"poem_analysis")).content}else return await H.analyzePoem(s,e,i)}async introducePoet(s){return this.config.useN8N?(await this.sendMessage([{role:"user",content:`请详细介绍诗人：${s}`}],"poet_introduction")).content:await H.introducePoet(s)}async testConnection(){const s={deepseek:!0,n8n:!1};if(this.config.useN8N)try{s.n8n=await b.testConnection()}catch{s.n8n=!1}return s}toggleServiceMode(s){this.config.useN8N=s,b.toggleServiceMode(s)}getConfig(){return{...this.config}}getServiceStatus(){return{current:this.config.useN8N?"n8n":"deepseek",n8nConfigured:!!b.getConfig().webhookUrl}}}const y=new Pe,Te={useN8N:!1,conversationId:"default_chat"};y.configure(Te);const De={class:"dialog-footer"},Ke=J({__name:"N8NConfig",props:{modelValue:{type:Boolean}},emits:["update:modelValue","configChanged"],setup(v,{emit:s}){const e=v,i=s,d=N(!1),c=N(!1),l=N(!1),a=be({webhookUrl:"",apiKey:"",useN8N:!1}),_=()=>{const p=b.getConfig();a.webhookUrl=p.webhookUrl,a.apiKey=p.apiKey||"",a.useN8N=p.useN8N};Y(()=>e.modelValue,p=>{d.value=p,p&&_()}),Y(d,p=>{i("update:modelValue",p)});const I=()=>{d.value=!1},V=p=>{p&&!p.startsWith("http")&&m.warning("请输入有效的URL地址")},x=p=>{if(p&&!a.webhookUrl){m.warning("请先配置Webhook URL"),a.useN8N=!1;return}},P=async()=>{if(!a.webhookUrl){m.warning("请先输入Webhook URL");return}c.value=!0;try{b.configure({webhookUrl:a.webhookUrl,apiKey:a.apiKey,useN8N:!0}),await b.testConnection()?m.success("n8n工作流连接成功！"):m.error("n8n工作流连接失败，请检查URL和配置")}catch(p){console.error("连接测试失败:",p),m.error("连接测试失败："+(p instanceof Error?p.message:"未知错误"))}finally{c.value=!1}},M=async()=>{if(a.useN8N&&!a.webhookUrl){m.warning("启用n8n模式需要配置Webhook URL");return}l.value=!0;try{b.configure({webhookUrl:a.webhookUrl,apiKey:a.apiKey,useN8N:a.useN8N}),y.toggleServiceMode(a.useN8N),m.success("配置保存成功！"),i("configChanged"),I()}catch(p){console.error("配置保存失败:",p),m.error("配置保存失败："+(p instanceof Error?p.message:"未知错误"))}finally{l.value=!1}};return(p,g)=>{const R=ne,T=ge,W=oe,j=me,D=ae,K=_e;return h(),ie(K,{modelValue:d.value,"onUpdate:modelValue":g[3]||(g[3]=u=>d.value=u),title:"n8n工作流配置",width:"500px","before-close":I},{footer:o(()=>[n("div",De,[t(D,{onClick:I},{default:o(()=>[...g[6]||(g[6]=[C("取消",-1)])]),_:1}),t(D,{type:"primary",onClick:P,loading:c.value},{default:o(()=>[...g[7]||(g[7]=[C(" 测试连接 ",-1)])]),_:1},8,["loading"]),t(D,{type:"success",onClick:M,loading:l.value},{default:o(()=>[...g[8]||(g[8]=[C(" 保存配置 ",-1)])]),_:1},8,["loading"])])]),default:o(()=>[t(j,{model:a,"label-width":"120px"},{default:o(()=>[t(T,{label:"Webhook URL",required:""},{default:o(()=>[t(R,{modelValue:a.webhookUrl,"onUpdate:modelValue":g[0]||(g[0]=u=>a.webhookUrl=u),placeholder:"请输入n8n工作流的Webhook URL",onChange:V},null,8,["modelValue"]),g[4]||(g[4]=n("div",{class:"form-tip"}," 在n8n工作流中创建的Webhook节点的URL地址 ",-1))]),_:1}),t(T,{label:"API密钥"},{default:o(()=>[t(R,{modelValue:a.apiKey,"onUpdate:modelValue":g[1]||(g[1]=u=>a.apiKey=u),type:"password",placeholder:"可选：如果需要认证的API密钥","show-password":""},null,8,["modelValue"]),g[5]||(g[5]=n("div",{class:"form-tip"}," 如果n8n工作流需要API密钥认证，请在此输入 ",-1))]),_:1}),t(T,{label:"启用n8n"},{default:o(()=>[t(W,{modelValue:a.useN8N,"onUpdate:modelValue":g[2]||(g[2]=u=>a.useN8N=u),"active-text":"启用","inactive-text":"禁用",onChange:x},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const Re=Q(Ke,[["__scopeId","data-v-5b15c67a"]]),ze={class:"ai-chat-assistant"},Le={class:"chat-header"},Oe={class:"assistant-info"},Be={class:"assistant-details"},We={class:"service-status"},je={class:"header-actions"},Fe={class:"message-avatar"},qe={class:"message-content"},He={class:"message-bubble"},Je={key:0,class:"user-message"},Qe={key:1,class:"assistant-message"},Xe={key:0,class:"loading-dots"},Ye=["innerHTML"],Ge={key:0,class:"message-actions"},Ze={class:"input-container"},et={class:"input-actions"},tt={class:"quick-actions"},st="/default-avatar.png",se="/ai-assistant.png",nt=J({__name:"AIChatAssistant",setup(v){const s=Me(),e=N([]),i=N(""),d=N(!1),c=N(),l=N(!1),a=N(!1),_=F(()=>y.getServiceStatus()),I=F(()=>({"status-online":_.value.n8nConfigured,"status-offline":!_.value.n8nConfigured&&l.value})),V=F(()=>l.value?_.value.n8nConfigured?"n8n已连接":"n8n未配置":"DeepSeek已连接"),x=[{text:"解析《静夜思》",prompt:"请帮我解析李白的《静夜思》"},{text:"介绍李白",prompt:"请介绍一下诗人李白的生平和创作特点"},{text:"唐诗特点",prompt:"唐诗的主要特点是什么？"},{text:"宋词格式",prompt:"宋词的基本格式和韵律要求是什么？"}],P=async u=>{try{const r=u.toLowerCase();if(["诗","词","诗人","解析","分析","李白","杜甫","苏轼","静夜思","唐诗","宋词"].some(A=>r.includes(A))){const A=u.match(/(《([^》]+)》|"([^"]+)"|'([^']+)'|([^，。！？]+诗)|([^，。！？]+词))/),E=u.match(/(李白|杜甫|苏轼|白居易|王维|李清照|辛弃疾|陆游|陶渊明)/);if(A){const L=A[1],O=E?E[1]:void 0;return O?await y.analyzePoem(L,O):await y.analyzePoem(L)}else if(E)return await y.introducePoet(E[1])}const U=[{role:"system",content:`你是一个专业的诗词AI助手，专门帮助用户理解古典诗词和文化。请用中文回答，回答要专业、详细且富有文化内涵。

**你的核心能力：**
1. 解析诗词的意境和情感
2. 分析诗词的艺术特色和修辞手法  
3. 介绍诗人的生平和创作背景
4. 比较不同诗词的异同
5. 提供诗词创作建议
6. 解答诗词相关的文化知识问题

**回答要求：**
- 保持回答的专业性和准确性
- 语言优美，富有文学气息
- 结构清晰，层次分明
- 适当引用相关诗词进行对比

如果用户的问题与诗词无关，请礼貌地引导用户关注诗词相关内容。`},{role:"user",content:u}];return(await y.sendMessage(U,"general_chat")).content}catch(r){throw console.error("聊天服务调用失败:",r),new Error("AI服务暂时不可用，请稍后重试")}},M=async()=>{if(!i.value.trim()||d.value)return;const u=i.value.trim();i.value="",e.value.push({role:"user",content:u,timestamp:Date.now()});const r={role:"assistant",content:"",isLoading:!0,timestamp:Date.now()};e.value.push(r),d.value=!0,K();try{const k=await P(u),z=e.value.length-1;e.value[z]={role:"assistant",content:k,isLoading:!1,timestamp:Date.now()}}catch(k){console.error("AI回复失败:",k),m.error(k instanceof Error?k.message:"回复生成失败，请重试"),e.value.pop()}finally{d.value=!1,K()}},p=u=>{i.value=u.prompt},g=async u=>{try{await navigator.clipboard.writeText(u.replace(/<\/?[^>]+(>|$)/g,"")),m.success("已复制到剪贴板")}catch(r){console.error("复制失败:",r),m.error("复制失败")}},R=u=>{if(!s.isAuthenticated){m.warning("请先登录以保存分析");return}m.success("分析已保存到个人收藏")},T=async u=>{try{y.toggleServiceMode(u);const r=await y.testConnection();u&&!r.n8n?(m.warning("n8n工作流连接失败，请检查配置"),l.value=!1,y.toggleServiceMode(!1)):m.success(`已切换到${u?"n8n工作流":"DeepSeek API"}模式`)}catch(r){console.error("服务切换失败:",r),m.error("服务切换失败，请检查配置"),l.value=!1,y.toggleServiceMode(!1)}},W=()=>{l.value=y.getConfig().useN8N},j=()=>{e.value=[],m.info("对话已清空")},D=u=>u.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>").replace(/- (.*?)(<br>|$)/g,"• $1<br>"),K=()=>{xe(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})};return Se(()=>{e.value.push({role:"assistant",content:"您好！我是诗词AI助手，可以帮您解析诗词、介绍诗人、解答文学问题。请告诉我您想了解的内容！",timestamp:Date.now()}),K()}),(u,r)=>{const k=ve,z=S("Setting"),U=re,$=ae,A=S("Refresh"),E=S("DocumentCopy"),L=S("Star"),O=ne,ce=S("Promotion"),ue=le;return h(),w("div",ze,[t(ue,{class:"chat-container"},{header:o(()=>[n("div",Le,[n("div",Oe,[t(k,{size:32,src:se}),n("div",Be,[r[5]||(r[5]=n("span",{class:"assistant-name"},"诗词AI助手",-1)),n("div",We,[r[4]||(r[4]=n("span",{class:"service-label"},"服务模式:",-1)),t(Ie(oe),{modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=f=>l.value=f),"active-text":"n8n工作流","inactive-text":"DeepSeek API",onChange:T},null,8,["modelValue"]),n("span",{class:G(["status-indicator",I.value])},q(V.value),3)])])]),n("div",je,[l.value?(h(),ie($,{key:0,type:"text",onClick:r[1]||(r[1]=f=>a.value=!0)},{default:o(()=>[t(U,null,{default:o(()=>[t(z)]),_:1}),r[6]||(r[6]=C(" 配置n8n ",-1))]),_:1})):Z("",!0),t($,{type:"text",onClick:j},{default:o(()=>[t(U,null,{default:o(()=>[t(A)]),_:1}),r[7]||(r[7]=C(" 清空对话 ",-1))]),_:1})])])]),default:o(()=>[n("div",{class:"messages-container",ref_key:"messagesContainer",ref:c},[(h(!0),w(ee,null,te(e.value,(f,X)=>(h(),w("div",{key:X,class:G(["message",f.role])},[n("div",Fe,[t(k,{size:32,src:f.role==="user"?st:se},null,8,["src"])]),n("div",qe,[n("div",He,[f.role==="user"?(h(),w("div",Je,q(f.content),1)):(h(),w("div",Qe,[f.isLoading?(h(),w("div",Xe,[...r[8]||(r[8]=[n("span",null,null,-1),n("span",null,null,-1),n("span",null,null,-1)])])):(h(),w("div",{key:1,innerHTML:D(f.content)},null,8,Ye))]))]),f.role==="assistant"&&!f.isLoading?(h(),w("div",Ge,[t($,{type:"text",size:"small",onClick:de=>g(f.content)},{default:o(()=>[t(U,null,{default:o(()=>[t(E)]),_:1}),r[9]||(r[9]=C(" 复制 ",-1))]),_:1},8,["onClick"]),t($,{type:"text",size:"small",onClick:de=>R(f.content)},{default:o(()=>[t(U,null,{default:o(()=>[t(L)]),_:1}),r[10]||(r[10]=C(" 保存分析 ",-1))]),_:1},8,["onClick"])])):Z("",!0)])],2))),128))],512),n("div",Ze,[t(O,{modelValue:i.value,"onUpdate:modelValue":r[2]||(r[2]=f=>i.value=f),type:"textarea",rows:3,placeholder:"请输入您想了解的诗词或诗人...",disabled:d.value,onKeydown:Ue($e(M,["exact","prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),n("div",et,[n("div",tt,[(h(),w(ee,null,te(x,f=>t($,{key:f.text,type:"text",size:"small",onClick:X=>p(f)},{default:o(()=>[C(q(f.text),1)]),_:2},1032,["onClick"])),64))]),t($,{type:"primary",loading:d.value,onClick:M,disabled:!i.value.trim()},{default:o(()=>[t(U,null,{default:o(()=>[t(ce)]),_:1}),r[11]||(r[11]=C(" 发送 ",-1))]),_:1},8,["loading","disabled"])])])]),_:1}),t(Re,{modelValue:a.value,"onUpdate:modelValue":r[3]||(r[3]=f=>a.value=f),onConfigChanged:W},null,8,["modelValue"])])}}});const ot=Q(nt,[["__scopeId","data-v-a0443804"]]),at={class:"ai-chat-page"},rt={class:"header-info"},lt={class:"feature-header"},it={class:"feature-header"},ct={class:"feature-header"},ut=J({__name:"AIChat",setup(v){return(s,e)=>{const i=ye,d=we,c=S("Reading"),l=re,a=le,_=Ce,I=S("User"),V=S("QuestionFilled"),x=ke,P=Ne,M=he;return h(),w("div",at,[t(M,null,{default:o(()=>[t(d,{class:"page-header"},{default:o(()=>[e[2]||(e[2]=n("h1",null,"诗词AI助手",-1)),n("div",rt,[t(i,{type:"success"},{default:o(()=>[...e[0]||(e[0]=[C("在线",-1)])]),_:1}),e[1]||(e[1]=n("span",{class:"assistant-desc"},"智能解析诗词，解答文学问题",-1))])]),_:1}),t(P,null,{default:o(()=>[t(ot),t(x,{gutter:20,class:"features-section"},{default:o(()=>[t(_,{span:8},{default:o(()=>[t(a,{shadow:"hover",class:"feature-card"},{header:o(()=>[n("div",lt,[t(l,{size:"24",color:"#409eff"},{default:o(()=>[t(c)]),_:1}),e[3]||(e[3]=n("span",null,"诗词解析",-1))])]),default:o(()=>[e[4]||(e[4]=n("p",null,"深度解析诗词的意境、修辞手法、历史背景，帮助您更好地理解诗歌内涵。",-1))]),_:1})]),_:1}),t(_,{span:8},{default:o(()=>[t(a,{shadow:"hover",class:"feature-card"},{header:o(()=>[n("div",it,[t(l,{size:"24",color:"#67c23a"},{default:o(()=>[t(I)]),_:1}),e[5]||(e[5]=n("span",null,"诗人介绍",-1))])]),default:o(()=>[e[6]||(e[6]=n("p",null,"详细介绍诗人的生平经历、创作风格、代表作品，了解文学大家的故事。",-1))]),_:1})]),_:1}),t(_,{span:8},{default:o(()=>[t(a,{shadow:"hover",class:"feature-card"},{header:o(()=>[n("div",ct,[t(l,{size:"24",color:"#e6a23c"},{default:o(()=>[t(V)]),_:1}),e[7]||(e[7]=n("span",null,"文学问答",-1))])]),default:o(()=>[e[8]||(e[8]=n("p",null,"解答关于古典文学、诗词格律、文学史等方面的疑问，满足您的求知欲。",-1))]),_:1})]),_:1})]),_:1}),t(a,{class:"examples-section"},{header:o(()=>[...e[9]||(e[9]=[n("span",null,"使用示例",-1)])]),default:o(()=>[t(x,{gutter:16},{default:o(()=>[t(_,{span:6},{default:o(()=>[...e[10]||(e[10]=[n("div",{class:"example-item"},[n("h4",null,"基础解析"),n("p",null,'"解析《静夜思》的意境"'),n("p",null,'"《水调歌头》表达了什么情感"')],-1)])]),_:1}),t(_,{span:6},{default:o(()=>[...e[11]||(e[11]=[n("div",{class:"example-item"},[n("h4",null,"诗人研究"),n("p",null,'"介绍李白的创作特点"'),n("p",null,'"杜甫的现实主义风格"')],-1)])]),_:1}),t(_,{span:6},{default:o(()=>[...e[12]||(e[12]=[n("div",{class:"example-item"},[n("h4",null,"文学知识"),n("p",null,'"唐诗和宋词的区别"'),n("p",null,'"什么是婉约派"')],-1)])]),_:1}),t(_,{span:6},{default:o(()=>[...e[13]||(e[13]=[n("div",{class:"example-item"},[n("h4",null,"创作指导"),n("p",null,'"如何赏析一首诗"'),n("p",null,'"诗词创作的基本要求"')],-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}});const _t=Q(ut,[["__scopeId","data-v-166a8299"]]);export{_t as default};
