import{d as ls,g as w,h as is,L as k,c as m,b as s,a,w as l,t as o,F as H,n as K,k as ns,K as u,r as f,o as g,m as c,e as v,T as rs,U as cs,V as ds,W as _s,x as us,j as vs,Q as ps,_ as fs}from"./main-3abf4ed4.js";import{c as h}from"./mockData-70ed22ed.js";const gs={class:"profile-page"},ms={class:"profile-content"},hs={class:"profile-layout"},ys={class:"profile-sidebar"},ws={class:"user-card"},ks={class:"user-avatar"},bs={class:"user-info"},xs={class:"username"},Ds={class:"user-email"},Ss={class:"stats-card"},Cs={class:"stats-grid"},Ps={class:"stat-item"},zs={class:"stat-value"},Ts={class:"stat-item"},Us={class:"stat-value"},Is={class:"stat-item"},Ns={class:"stat-value"},Bs={class:"stat-item"},Ls={class:"stat-value"},Ms={class:"quick-actions"},Os={class:"actions-grid"},Rs={class:"profile-main"},Vs={class:"section-card"},As={class:"progress-stats"},$s={class:"progress-item"},qs={class:"progress-info"},Es={class:"progress-value"},Fs={class:"progress-item"},js={class:"progress-info"},Hs={class:"progress-value"},Ks={class:"progress-item"},Qs={class:"progress-info"},Ws={class:"progress-value"},Gs={class:"section-card"},Js={class:"activity-list"},Xs={class:"activity-icon"},Ys={class:"activity-content"},Zs={class:"activity-title"},st={class:"activity-time"},tt={class:"section-card"},et={class:"interest-tags"},at={class:"section-card"},ot={class:"account-info"},lt={class:"info-item"},it={class:"info-value"},nt={class:"info-item"},rt={class:"info-value"},ct={class:"info-item"},dt={class:"info-value"},_t=ls({__name:"Profile",setup(ut){const b=ns(),n=w(null),i=w(null),x=w([]);is(async()=>{await Q(),await W(),await G()});const Q=async()=>{try{const{data:{user:e}}=await k.auth.getUser();if(e){const{data:t,error:d}=await k.from("profiles").select("*").eq("id",e.id).single();d?(console.error("加载用户资料失败:",d),n.value=h()):n.value={...e,...t}}else b.push("/login")}catch(e){console.error("加载用户资料异常:",e),n.value=h()}},W=async()=>{try{i.value=h()}catch(e){console.error("加载用户统计异常:",e),i.value=h()}},G=async()=>{try{x.value=[{id:"1",title:"解析了《静夜思》",created_at:new Date().toISOString()},{id:"2",title:"完成了唐诗学习任务",created_at:new Date(Date.now()-864e5).toISOString()},{id:"3",title:"收藏了《春晓》",created_at:new Date(Date.now()-1728e5).toISOString()}]}catch(e){console.error("加载活动记录异常:",e)}},J=e=>({student:"success",teacher:"warning",admin:"danger"})[e]||"info",X=e=>({student:"学生",teacher:"教师",admin:"管理员"})[e]||"用户",Y=()=>{u.info("编辑资料功能开发中")},Z=()=>{u.info("修改密码功能开发中")},ss=()=>{u.info("查看学习历史功能开发中")},ts=()=>{u.info("编辑兴趣功能开发中")},es=async()=>{try{const{error:e}=await k.auth.signOut();if(e)throw e;u.success("退出登录成功"),b.push("/login")}catch(e){console.error("退出登录失败:",e),u.error("退出登录失败")}},as=e=>new Date(e).toLocaleString("zh-CN"),D=e=>e?new Date(e).toLocaleDateString("zh-CN"):"未知",os=e=>{if(!e)return"0分钟";const t=Math.floor(e/60),d=e%60;return t>0?`${t}小时${d}分钟`:`${d}分钟`};return(e,t)=>{var C,P,z,T,U,I,N,B,L,M,O,R,V,A,$,q,E,F;const d=f("el-avatar"),S=f("el-tag"),_=f("el-icon"),p=f("el-button"),y=f("el-progress");return g(),m("div",gs,[t[21]||(t[21]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"个人中心")],-1)),s("div",ms,[s("div",hs,[s("div",ys,[s("div",ws,[s("div",ks,[a(d,{size:80,src:(C=n.value)==null?void 0:C.avatar_url},{default:l(()=>{var r,j;return[c(o(((j=(r=n.value)==null?void 0:r.username)==null?void 0:j.charAt(0))||"U"),1)]}),_:1},8,["src"])]),s("div",bs,[s("h2",xs,o(((P=n.value)==null?void 0:P.username)||"用户"),1),s("p",Ds,o((z=n.value)==null?void 0:z.email),1),a(S,{type:J((T=n.value)==null?void 0:T.role),size:"small"},{default:l(()=>{var r;return[c(o(X((r=n.value)==null?void 0:r.role)),1)]}),_:1},8,["type"])])]),s("div",Ss,[t[4]||(t[4]=s("h3",{class:"stats-title"},"学习统计",-1)),s("div",Cs,[s("div",Ps,[s("div",zs,o(((U=i.value)==null?void 0:U.analyzed_poems)||0),1),t[0]||(t[0]=s("div",{class:"stat-label"},"已解析诗词",-1))]),s("div",Ts,[s("div",Us,o(((I=i.value)==null?void 0:I.streak_days)||0),1),t[1]||(t[1]=s("div",{class:"stat-label"},"连续学习天数",-1))]),s("div",Is,[s("div",Ns,o(((N=i.value)==null?void 0:N.average_score)||0)+"%",1),t[2]||(t[2]=s("div",{class:"stat-label"},"平均得分",-1))]),s("div",Bs,[s("div",Ls,o(((B=i.value)==null?void 0:B.mastery_level)||"初级"),1),t[3]||(t[3]=s("div",{class:"stat-label"},"掌握等级",-1))])])]),s("div",Ms,[t[9]||(t[9]=s("h3",{class:"actions-title"},"快捷操作",-1)),s("div",Os,[a(p,{type:"primary",onClick:Y},{default:l(()=>[a(_,null,{default:l(()=>[a(v(rs))]),_:1}),t[5]||(t[5]=c(" 编辑资料 ",-1))]),_:1}),a(p,{onClick:Z},{default:l(()=>[a(_,null,{default:l(()=>[a(v(cs))]),_:1}),t[6]||(t[6]=c(" 修改密码 ",-1))]),_:1}),a(p,{onClick:ss},{default:l(()=>[a(_,null,{default:l(()=>[a(v(ds))]),_:1}),t[7]||(t[7]=c(" 学习历史 ",-1))]),_:1}),a(p,{onClick:es},{default:l(()=>[a(_,null,{default:l(()=>[a(v(_s))]),_:1}),t[8]||(t[8]=c(" 退出登录 ",-1))]),_:1})])])]),s("div",Rs,[s("div",Vs,[t[13]||(t[13]=s("h3",{class:"section-title"},"学习进度",-1)),s("div",As,[s("div",$s,[s("div",qs,[t[10]||(t[10]=s("span",{class:"progress-label"},"总体进度",-1)),s("span",Es,o(((L=i.value)==null?void 0:L.learning_progress)||0)+"%",1)]),a(y,{percentage:((M=i.value)==null?void 0:M.learning_progress)||0,"show-text":!1},null,8,["percentage"])]),s("div",Fs,[s("div",js,[t[11]||(t[11]=s("span",{class:"progress-label"},"本周活跃度",-1)),s("span",Hs,o(((O=i.value)==null?void 0:O.weekly_activity)||0)+"%",1)]),a(y,{percentage:((R=i.value)==null?void 0:R.weekly_activity)||0,"show-text":!1,status:"success"},null,8,["percentage"])]),s("div",Ks,[s("div",Qs,[t[12]||(t[12]=s("span",{class:"progress-label"},"完成率",-1)),s("span",Ws,o(((V=i.value)==null?void 0:V.completion_rate)||0)+"%",1)]),a(y,{percentage:((A=i.value)==null?void 0:A.completion_rate)||0,"show-text":!1,status:"warning"},null,8,["percentage"])])])]),s("div",Gs,[t[14]||(t[14]=s("h3",{class:"section-title"},"最近活动",-1)),s("div",Js,[(g(!0),m(H,null,K(x.value,r=>(g(),m("div",{key:r.id,class:"activity-item"},[s("div",Xs,[a(_,null,{default:l(()=>[a(v(us))]),_:1})]),s("div",Ys,[s("div",Zs,o(r.title),1),s("div",st,o(as(r.created_at)),1)])]))),128))])]),s("div",tt,[t[16]||(t[16]=s("h3",{class:"section-title"},"兴趣标签",-1)),s("div",et,[(g(!0),m(H,null,K((($=n.value)==null?void 0:$.interests)||[],r=>(g(),vs(S,{key:r,type:"info",size:"large",class:"interest-tag"},{default:l(()=>[c(o(r),1)]),_:2},1024))),128)),a(p,{text:"",onClick:ts,class:"add-interest"},{default:l(()=>[a(_,null,{default:l(()=>[a(v(ps))]),_:1}),t[15]||(t[15]=c(" 添加兴趣 ",-1))]),_:1})])]),s("div",at,[t[20]||(t[20]=s("h3",{class:"section-title"},"账户信息",-1)),s("div",ot,[s("div",lt,[t[17]||(t[17]=s("span",{class:"info-label"},"注册时间：",-1)),s("span",it,o(D((q=n.value)==null?void 0:q.created_at)),1)]),s("div",nt,[t[18]||(t[18]=s("span",{class:"info-label"},"最后登录：",-1)),s("span",rt,o(D((E=n.value)==null?void 0:E.last_login_at)),1)]),s("div",ct,[t[19]||(t[19]=s("span",{class:"info-label"},"学习时长：",-1)),s("span",dt,o(os((F=i.value)==null?void 0:F.weekly_study_time)),1)])])])])])])])}}});const ft=fs(_t,[["__scopeId","data-v-e3a81f47"]]);export{ft as default};
