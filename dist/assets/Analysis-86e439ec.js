import{a as O,O as X,d as Y,m as Z,P as ss,g as ts}from"./element-plus-7b99588a.js";import{q as es,r as S,c as as,z as os,D as d,E as s,U as a,W as _,P as m,V as y,ak as f,T as u,bD as ns,bz as ls,C as r,u as $,O as is}from"./vendor-0fc5911b.js";import{g as L,a as R}from"./mockData-3b1561c6.js";import{s as h,_ as rs}from"./index-c5ff4cf6.js";import"./supabase-043902eb.js";const cs={class:"analysis-page"},ds={class:"page-header"},us={class:"header-content"},_s={class:"poem-info"},ms={class:"poem-title"},vs={class:"poem-meta"},ps={class:"author"},ys={class:"dynasty"},fs={class:"header-actions"},hs={class:"main-content"},gs={class:"analysis-layout"},ks={class:"poem-section"},ws={class:"section-card"},xs={class:"poem-content"},As={class:"section-card"},Ds={class:"line-analysis"},Es={class:"line-text"},bs={class:"line-meaning"},Cs={class:"analysis-section"},Is={class:"section-card"},Ps={class:"analysis-content"},Bs={class:"section-card"},Ts={class:"imagery-analysis"},Vs={class:"section-card"},zs={class:"author-info"},Ms={class:"works"},qs={class:"section-card"},Ns={class:"historical-context"},Os=es({__name:"Analysis",setup(Ss){const U=ns(),F=ls(),n=S(null),l=S(null),c=as(()=>U.params.id);os(async()=>{await W()});const W=async()=>{try{const{data:e,error:t}=await h.from("poems").select("*").eq("id",c.value).single();if(t){console.error("加载诗词失败:",t);const i=L();n.value=i.find(v=>v.id===c.value)||i[0]}else n.value=e;l.value=R(c.value),await Q()}catch(e){console.error("加载诗词数据异常:",e);const t=L();n.value=t.find(i=>i.id===c.value)||t[0],l.value=R(c.value)}},j=e=>({easy:"success",medium:"warning",hard:"danger"})[e]||"info",G=e=>({easy:"简单",medium:"中等",hard:"困难"})[e]||"未知",H=e=>{var i;const t=((i=l.value)==null?void 0:i.word_analysis)||[];return t[e]?`${t[e].character}：${t[e].meaning}`:"暂无详细解析"},J=()=>{F.push(`/chat?poem=${c.value}`)},K=async()=>{var e;try{const{error:t}=await h.from("user_analysis").upsert({user_id:(e=(await h.auth.getUser()).data.user)==null?void 0:e.id,poem_id:c.value,analysis_data:l.value,created_at:new Date().toISOString()});if(t)throw t;O.success("分析已保存")}catch(t){console.error("保存分析失败:",t),O.error("保存失败，请重试")}},Q=async()=>{var e;try{await h.from("poems").update({views:(((e=n.value)==null?void 0:e.views)||0)+1}).eq("id",c.value)}catch(t){console.error("记录查看失败:",t)}};return(e,t)=>{var k,w,x,A,D,E,b,C,I,P,B,T,V,z,M,q,N;const i=X,v=ts,g=Y;return r(),d("div",cs,[s("div",ds,[s("div",us,[s("div",_s,[s("h1",ms,a((k=n.value)==null?void 0:k.title),1),s("div",vs,[s("span",ps,a((w=n.value)==null?void 0:w.author),1),s("span",ys,a((x=n.value)==null?void 0:x.dynasty),1),_(i,{type:j((A=n.value)==null?void 0:A.difficulty),size:"small"},{default:m(()=>{var o;return[u(a(G((o=n.value)==null?void 0:o.difficulty)),1)]}),_:1},8,["type"])])]),s("div",fs,[_(g,{type:"primary",onClick:J},{default:m(()=>[_(v,null,{default:m(()=>[_($(Z))]),_:1}),t[0]||(t[0]=u(" 与AI讨论 ",-1))]),_:1}),_(g,{onClick:K},{default:m(()=>[_(v,null,{default:m(()=>[_($(ss))]),_:1}),t[1]||(t[1]=u(" 保存分析 ",-1))]),_:1})])])]),s("div",hs,[s("div",gs,[s("div",ks,[s("div",ws,[t[2]||(t[2]=s("h3",{class:"section-title"},"诗词原文",-1)),s("div",xs,[(r(!0),d(y,null,f((D=n.value)==null?void 0:D.content,(o,p)=>(r(),d("p",{key:p,class:"poem-line"},a(o),1))),128))])]),s("div",As,[t[3]||(t[3]=s("h3",{class:"section-title"},"逐句解析",-1)),s("div",Ds,[(r(!0),d(y,null,f((E=n.value)==null?void 0:E.content,(o,p)=>(r(),d("div",{key:p,class:"line-item"},[s("div",Es,a(o),1),s("div",bs,a(H(p)),1)]))),128))])])]),s("div",Cs,[s("div",Is,[t[4]||(t[4]=s("h3",{class:"section-title"},"整体分析",-1)),s("div",Ps,[s("p",null,a((b=l.value)==null?void 0:b.overall_analysis),1)])]),s("div",Bs,[t[7]||(t[7]=s("h3",{class:"section-title"},"意象分析",-1)),s("div",Ts,[(r(!0),d(y,null,f((C=l.value)==null?void 0:C.imagery_analysis,o=>(r(),d("div",{key:o.name,class:"imagery-item"},[s("h4",null,a(o.name),1),s("p",null,[t[5]||(t[5]=s("strong",null,"描述：",-1)),u(a(o.description),1)]),s("p",null,[t[6]||(t[6]=s("strong",null,"象征意义：",-1)),u(a(o.symbolism),1)])]))),128))])]),s("div",Vs,[t[11]||(t[11]=s("h3",{class:"section-title"},"作者信息",-1)),s("div",zs,[s("h4",null,a((P=(I=l.value)==null?void 0:I.author_info)==null?void 0:P.name),1),s("p",null,[t[8]||(t[8]=s("strong",null,"朝代：",-1)),u(a((T=(B=l.value)==null?void 0:B.author_info)==null?void 0:T.dynasty),1)]),s("p",null,[t[9]||(t[9]=s("strong",null,"简介：",-1)),u(a((z=(V=l.value)==null?void 0:V.author_info)==null?void 0:z.biography),1)]),s("div",Ms,[t[10]||(t[10]=s("strong",null,"代表作品：",-1)),(r(!0),d(y,null,f((q=(M=l.value)==null?void 0:M.author_info)==null?void 0:q.works,o=>(r(),is(i,{key:o,size:"small",style:{margin:"2px 4px"}},{default:m(()=>[u(a(o),1)]),_:2},1024))),128))])])]),s("div",qs,[t[12]||(t[12]=s("h3",{class:"section-title"},"历史背景",-1)),s("div",Ns,[s("p",null,a((N=l.value)==null?void 0:N.historical_context),1)])])])])])])}}});const Ws=rs(Os,[["__scopeId","data-v-25431d2f"]]);export{Ws as default};
